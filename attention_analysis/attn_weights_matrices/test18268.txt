18268
Test: public void testOptimizationOrder() { final List<String> visitationLog = Lists.newArrayList(); AbstractPeepholeOptimization note1Applied = new AbstractPeepholeOptimization() { @Override public Node optimizeSubtree(Node node) { if (node.isName()) { visitationLog.add(node.getString() + "1"); } return node; } }; AbstractPeepholeOptimization note2Applied = new AbstractPeepholeOptimization() { @Override public Node optimizeSubtree(Node node) { if (node.isName()) { visitationLog.add(node.getString() + "2"); } return node; } }; currentPeepholePasses = ImmutableList.< AbstractPeepholeOptimization>of(note1Applied, note2Applied); test("var x; var y", "var x; var y"); }
Code: public Node optimizeSubtree(Node node){switch(node.getType()) {case Token.TRUE:case Token.FALSE:return reduceTrueFalse(node);case Token.NEW:;if (!node.isCall()) {return node;}case Token.CALL:Node result = tryFoldLiteralConstructor(node);if (result == node) {;if (result == node) {result = tryFoldImmediateCallToBoundFunction(node);}}return result;case Token.RETURN:return tryReduceReturn(node);case Token.COMMA:return trySplitComma(node);case Token.NAME:return tryReplaceUndefined(node);case Token.ARRAYLIT:return tryMinimizeArrayLiteral(node);default:return node; }}
[[0.01747359 0.03597309 0.01085947 0.03089109 0.05284359 0.02457365
 0.03472423 0.02598112 0.02110353 0.04839335 0.05678608 0.01097526
 0.02362211 0.01331132 0.01121311 0.02255189 0.04577271 0.02658551
 0.02300072 0.010864   0.04577271 0.02658551 0.02300072 0.02986097
 0.01121311 0.01523249 0.00690195 0.0305431  0.00932416 0.01950639
 0.04431448 0.02873899 0.02628636 0.02870129 0.01975364 0.02370694
 0.06305777]
[0.01289095 0.03998153 0.01110514 0.02318065 0.04667489 0.0268734
 0.04119263 0.02523734 0.01580614 0.06593467 0.05858295 0.00986474
 0.02110661 0.01462111 0.01241144 0.02252129 0.03837503 0.02205593
 0.02073285 0.00940663 0.03837503 0.02205593 0.02073285 0.03759921
 0.01241144 0.01684324 0.00698761 0.03487499 0.01674552 0.01583578
 0.05773816 0.03155343 0.02346778 0.02877495 0.01650389 0.02135808
 0.05958619]
[0.01494467 0.0323318  0.00872745 0.02556209 0.07130635 0.02557608
 0.04177828 0.03027153 0.01430282 0.05229998 0.05750674 0.0092719
 0.02316525 0.01326932 0.01024638 0.01841354 0.03577422 0.02321221
 0.02267159 0.00843796 0.03577422 0.02321221 0.02267159 0.03562936
 0.01024638 0.01629119 0.00588709 0.03293046 0.01110258 0.01820578
 0.04781563 0.02785873 0.02538953 0.03551377 0.01964406 0.02399236
 0.06876495]
[0.01319574 0.03129996 0.0092811  0.02176505 0.052399   0.02984797
 0.04043716 0.02670242 0.01410982 0.06941654 0.0555911  0.01146437
 0.01928596 0.01084773 0.0100877  0.02455824 0.04901019 0.0199845
 0.02253187 0.00903993 0.04901019 0.0199845  0.02253187 0.03274557
 0.0100877  0.0131505  0.00540614 0.03052723 0.01131822 0.01630895
 0.06310587 0.02850294 0.02631633 0.03002831 0.01544678 0.02165379
 0.06301869]
[0.01244368 0.03655154 0.01078416 0.02240548 0.06269587 0.02712066
 0.0428462  0.03697437 0.01610393 0.04612346 0.04616887 0.00903266
 0.02011386 0.01188654 0.01025605 0.02178002 0.04470713 0.02368432
 0.02134558 0.01009271 0.04470713 0.02368432 0.02134558 0.03194234
 0.01025605 0.01159686 0.00556554 0.04200695 0.00974718 0.0163516
 0.05528109 0.03099009 0.03045802 0.02614758 0.01449521 0.02120368
 0.07110363]
[0.01825631 0.0360391  0.00984155 0.02538515 0.04318853 0.03153569
 0.0362353  0.02221258 0.01915262 0.049916   0.05844388 0.0139303
 0.0261304  0.01297468 0.01241784 0.02439848 0.0394234  0.02598385
 0.02286726 0.01003382 0.0394234  0.02598385 0.02286726 0.03254892
 0.01241784 0.01644163 0.00720951 0.03377747 0.0164     0.02294303
 0.05811641 0.02804141 0.02480502 0.02887826 0.01613786 0.02568563
 0.04995576]
[0.01438605 0.03015624 0.00782674 0.02685808 0.06310482 0.02721217
 0.0422081  0.02970196 0.01680603 0.05090476 0.06408578 0.01123352
 0.0223413  0.01119449 0.01043095 0.02301447 0.0422189  0.01985257
 0.01664807 0.01021755 0.0422189  0.01985257 0.01664807 0.03215871
 0.01043095 0.01220746 0.00560166 0.03203997 0.0096804  0.01664555
 0.06201335 0.02685889 0.0283698  0.03253555 0.01524313 0.02089431
 0.07619809]
[0.01579647 0.03395525 0.00998383 0.02130317 0.06718093 0.02975364
 0.04053999 0.02348629 0.02069804 0.04929819 0.05198371 0.01000441
 0.02266518 0.01218073 0.01133219 0.02488515 0.04118524 0.02113687
 0.02117653 0.01248494 0.04118524 0.02113687 0.02117653 0.03535238
 0.01133219 0.02176889 0.00787628 0.03399853 0.01347063 0.02024077
 0.05305696 0.02350113 0.03244594 0.02910351 0.02195485 0.01787387
 0.05349468]
[0.01421349 0.0404187  0.00832594 0.0329666  0.05010996 0.03008995
 0.0392828  0.0238693  0.01346585 0.04380509 0.06527179 0.00973611
 0.02466185 0.00985981 0.01038061 0.02481485 0.04478177 0.02279255
 0.01885244 0.00927156 0.04478177 0.02279255 0.01885244 0.02790506
 0.01038061 0.01275525 0.00659322 0.04123537 0.01600133 0.01501552
 0.05676144 0.02533946 0.02445978 0.02390722 0.01435468 0.01661786
 0.08527537]
[0.01896146 0.03317444 0.01093246 0.02507411 0.03554409 0.03199925
 0.03777787 0.02805226 0.01939492 0.04814185 0.04904878 0.01136406
 0.02313332 0.01104402 0.01348092 0.02954675 0.04110345 0.02336933
 0.02238309 0.01289387 0.04110345 0.02336933 0.02238309 0.02838261
 0.01348092 0.01708595 0.00867134 0.03555642 0.013493   0.02058986
 0.06230782 0.02671261 0.02959916 0.02650363 0.01948461 0.02309357
 0.06176229]
[0.01251757 0.03395229 0.00951975 0.02539877 0.05102896 0.02649035
 0.04188349 0.02680121 0.01664316 0.04979904 0.05651799 0.01064682
 0.01910037 0.01184539 0.0115994  0.02465179 0.05067205 0.01823222
 0.02200654 0.01106444 0.05067205 0.01823222 0.02200654 0.03210399
 0.0115994  0.01365856 0.00707586 0.03102444 0.00998489 0.0179508
 0.05856955 0.02761663 0.02831366 0.02509494 0.02174863 0.02175602
 0.07222016]
[0.01535024 0.03452705 0.00874767 0.02559392 0.06510045 0.02716424
 0.03404563 0.02428303 0.01366853 0.05302291 0.05324899 0.01053536
 0.02057107 0.01327289 0.00964543 0.02519402 0.0426694  0.02595223
 0.02290568 0.00849828 0.0426694  0.02595223 0.02290568 0.03320506
 0.00964543 0.01633379 0.00587131 0.03376881 0.01033698 0.02025475
 0.05532868 0.02964522 0.02103853 0.0389604  0.01860608 0.02017846
 0.06130211]
[0.01366322 0.02953622 0.00799402 0.01883486 0.05696113 0.02815542
 0.04093232 0.02708337 0.0186864  0.04615808 0.05931822 0.01092411
 0.02116927 0.00853973 0.01129343 0.02659466 0.04857903 0.01845987
 0.02265843 0.01095839 0.04857903 0.01845987 0.02265843 0.03239422
 0.01129343 0.01371325 0.00681143 0.0420231  0.01178751 0.01722358
 0.05385555 0.02283777 0.03048152 0.02822166 0.01721319 0.01978069
 0.07616556]
[0.01908046 0.03976006 0.00918736 0.02086079 0.06993175 0.02598265
 0.03409921 0.02678367 0.013555   0.04816631 0.05047183 0.00997593
 0.02249045 0.01339863 0.00992253 0.02181638 0.04674269 0.01952759
 0.02323516 0.01087287 0.04674269 0.01952759 0.02323516 0.0384043
 0.00992253 0.01584517 0.00599344 0.03042472 0.01206303 0.01724248
 0.05337969 0.02587887 0.02526872 0.03776115 0.01659462 0.02182844
 0.0640261 ]
[0.02117953 0.03295362 0.01214461 0.02284517 0.03509535 0.0239048
 0.02929066 0.03554668 0.02152742 0.04686341 0.04089265 0.01360427
 0.02426463 0.01296752 0.01775711 0.02667299 0.03578189 0.02372723
 0.02920078 0.01424171 0.03578189 0.02372723 0.02920078 0.03337439
 0.01775711 0.02158523 0.01137151 0.04014508 0.01497101 0.01925746
 0.04152191 0.02733554 0.0283925  0.03186994 0.02697832 0.02225162
 0.05401649]
[0.01689734 0.0356613  0.01049088 0.02511866 0.05214395 0.02895407
 0.0402881  0.03135908 0.01913265 0.05295609 0.04574756 0.01035926
 0.02080663 0.01254404 0.01131591 0.03002799 0.0396616  0.02112116
 0.02060602 0.01061686 0.0396616  0.02112116 0.02060602 0.03450611
 0.01131591 0.01339515 0.00631544 0.03355769 0.01254501 0.01606134
 0.05857764 0.03340603 0.02801623 0.03208132 0.0149199  0.02379667
 0.06430756]
[0.01622877 0.03132833 0.01145132 0.02329086 0.04983811 0.0292424
 0.04385103 0.02341769 0.02327736 0.04190714 0.056451   0.01231258
 0.02561545 0.01261702 0.0111775  0.0298049  0.04359751 0.02453918
 0.02103135 0.01317283 0.04359751 0.02453918 0.02103135 0.02796478
 0.0111775  0.01548728 0.00897456 0.03458774 0.01330798 0.01932622
 0.05950864 0.02700432 0.02576966 0.02970719 0.01672106 0.02394449
 0.05319814]
[0.00893237 0.03528536 0.00808356 0.02107836 0.05435291 0.02479883
 0.04454368 0.02384059 0.01306211 0.06906026 0.06899989 0.00786946
 0.01997451 0.01133221 0.00948269 0.02098877 0.05071625 0.02148024
 0.01692113 0.00662869 0.05071625 0.02148024 0.01692113 0.03204502
 0.00948269 0.01093714 0.00400815 0.03773865 0.00953492 0.01618885
 0.06957377 0.02707715 0.01876888 0.02920916 0.01024668 0.02112468
 0.07751479]
[0.01520106 0.0378431  0.00998184 0.02823681 0.05866275 0.03325497
 0.03982596 0.03074225 0.01760949 0.05194606 0.04583263 0.0104514
 0.02199483 0.01450601 0.00988166 0.02524647 0.04591222 0.01859177
 0.01863927 0.00929711 0.04591222 0.01859177 0.01863927 0.03746199
 0.00988166 0.01322041 0.00755688 0.03456802 0.01242927 0.0167498
 0.05121543 0.03116757 0.03144885 0.02548786 0.01602407 0.02011487
 0.06587241]
[0.01050837 0.03792223 0.0085423  0.02415364 0.05746458 0.02644814
 0.04244632 0.03228834 0.01752219 0.05691413 0.05350994 0.01056804
 0.02142764 0.01375905 0.01053747 0.02053578 0.04196905 0.02009896
 0.0202056  0.0101949  0.04196905 0.02009896 0.0202056  0.03501929
 0.01053747 0.01184547 0.00608116 0.03739237 0.01122445 0.01484031
 0.06530008 0.02628238 0.02806197 0.03210846 0.01745961 0.02102504
 0.06353173]
[0.01622877 0.03132833 0.01145132 0.02329086 0.04983811 0.0292424
 0.04385103 0.02341769 0.02327736 0.04190714 0.056451   0.01231258
 0.02561545 0.01261702 0.0111775  0.0298049  0.04359751 0.02453918
 0.02103135 0.01317283 0.04359751 0.02453918 0.02103135 0.02796478
 0.0111775  0.01548728 0.00897456 0.03458774 0.01330798 0.01932622
 0.05950864 0.02700432 0.02576966 0.02970719 0.01672106 0.02394449
 0.05319814]
[0.00893237 0.03528536 0.00808356 0.02107836 0.05435291 0.02479883
 0.04454368 0.02384059 0.01306211 0.06906026 0.06899989 0.00786946
 0.01997451 0.01133221 0.00948269 0.02098877 0.05071625 0.02148024
 0.01692113 0.00662869 0.05071625 0.02148024 0.01692113 0.03204502
 0.00948269 0.01093714 0.00400815 0.03773865 0.00953492 0.01618885
 0.06957377 0.02707715 0.01876888 0.02920916 0.01024668 0.02112468
 0.07751479]
[0.01520106 0.0378431  0.00998184 0.02823681 0.05866275 0.03325497
 0.03982596 0.03074225 0.01760949 0.05194606 0.04583263 0.0104514
 0.02199483 0.01450601 0.00988166 0.02524647 0.04591222 0.01859177
 0.01863927 0.00929711 0.04591222 0.01859177 0.01863927 0.03746199
 0.00988166 0.01322041 0.00755688 0.03456802 0.01242927 0.0167498
 0.05121543 0.03116757 0.03144885 0.02548786 0.01602407 0.02011487
 0.06587241]
[0.01402642 0.02875705 0.00824849 0.02429646 0.07858276 0.02917681
 0.04061951 0.0268754  0.01444884 0.04706633 0.05159539 0.00844427
 0.01988465 0.01082584 0.00937619 0.02493333 0.05013242 0.01900332
 0.01575323 0.01435468 0.05013242 0.01900332 0.01575323 0.03431874
 0.00937619 0.01258647 0.0050752  0.03629466 0.01673493 0.01436904
 0.05920751 0.03079542 0.02544078 0.02975348 0.01563452 0.01748894
 0.07163373]
[0.02117953 0.03295362 0.01214461 0.02284517 0.03509535 0.0239048
 0.02929066 0.03554668 0.02152742 0.04686341 0.04089265 0.01360427
 0.02426463 0.01296752 0.01775711 0.02667299 0.03578189 0.02372723
 0.02920078 0.01424171 0.03578189 0.02372723 0.02920078 0.03337439
 0.01775711 0.02158523 0.01137151 0.04014508 0.01497101 0.01925746
 0.04152191 0.02733554 0.0283925  0.03186994 0.02697832 0.02225162
 0.05401649]
[0.0110393  0.032766   0.0069813  0.02687776 0.06128861 0.02419191
 0.03849585 0.02664009 0.01480076 0.06283354 0.06517183 0.00764847
 0.02036038 0.01252347 0.00852385 0.02178787 0.04533441 0.01992976
 0.01621612 0.00978609 0.04533441 0.01992976 0.01621612 0.03297698
 0.00852385 0.01105763 0.00460255 0.04021102 0.01066878 0.0154016
 0.05700383 0.02985552 0.02140776 0.02781003 0.01308895 0.01755644
 0.09515733]
[0.01462138 0.03256219 0.00935487 0.02187337 0.06532726 0.02708483
 0.03805688 0.0280715  0.01799097 0.06011015 0.04108328 0.00907221
 0.01817032 0.01379781 0.0111653  0.02284234 0.03884701 0.02417932
 0.02158119 0.00833819 0.03884701 0.02417932 0.02158119 0.02731844
 0.0111653  0.013002   0.00502006 0.03992389 0.01405834 0.0154977
 0.0612767  0.02924572 0.02516447 0.03103292 0.01883781 0.01956918
 0.0801496 ]
[0.01592766 0.04042854 0.01084196 0.02272403 0.05350227 0.02646005
 0.04109371 0.02886069 0.01511091 0.0525244  0.05301898 0.01113806
 0.02128747 0.01184488 0.01076755 0.02574559 0.04346706 0.02434931
 0.01861442 0.01088898 0.04346706 0.02434931 0.01861442 0.035955
 0.01076755 0.01571639 0.00796664 0.03196678 0.01071973 0.01434397
 0.06017421 0.0241302  0.03212208 0.02606221 0.01889869 0.020991
 0.06515826]
[0.01481536 0.03142341 0.00828249 0.02426188 0.05355117 0.02846467
 0.04055896 0.02675124 0.01835008 0.0599139  0.05545379 0.00770427
 0.01915208 0.01270342 0.01040235 0.020533   0.03846081 0.02001462
 0.02072595 0.01015075 0.03846081 0.02001462 0.02072595 0.03270534
 0.01040235 0.01249005 0.00580448 0.03916305 0.01413246 0.01591881
 0.05911655 0.03251074 0.02344782 0.03742474 0.0148399  0.02016236
 0.0810058 ]
[0.01610623 0.0393029  0.01328361 0.02546103 0.04525182 0.03438522
 0.03666734 0.02682157 0.01646804 0.05144306 0.05861855 0.01109606
 0.02263072 0.01431239 0.0157901  0.03286548 0.03714665 0.01942713
 0.01683015 0.01275211 0.03714665 0.01942713 0.01683015 0.02534987
 0.0157901  0.01382663 0.00821582 0.03185071 0.01419813 0.01731998
 0.05739741 0.0321528  0.0259967  0.03504634 0.01638554 0.02718788
 0.05921795]
[0.0186895  0.03162808 0.01016317 0.02197247 0.04893663 0.03187713
 0.03951443 0.02177154 0.02008437 0.04202367 0.0541281  0.01284151
 0.024463   0.01188697 0.01082426 0.02855934 0.04090535 0.02373231
 0.02545184 0.01224228 0.04090535 0.02373231 0.02545184 0.02941068
 0.01082426 0.01702131 0.0057931  0.03681733 0.01491444 0.01838727
 0.06367463 0.02501921 0.03062261 0.03115965 0.01940256 0.01902423
 0.05614332]
[0.0134867  0.03738208 0.00975624 0.02349925 0.06391899 0.02856124
 0.03229924 0.02276039 0.01227311 0.06312908 0.06015298 0.0089165
 0.02154242 0.00869349 0.01162842 0.02266341 0.04640822 0.02291639
 0.01899176 0.00982459 0.04640822 0.02291639 0.01899176 0.03173919
 0.01162842 0.01552312 0.00577974 0.03546487 0.00995139 0.01533927
 0.05743393 0.02656421 0.02331196 0.02755629 0.01794442 0.01619075
 0.07845148]
[0.01307263 0.03442434 0.00768911 0.02595554 0.06069038 0.02847386
 0.03910426 0.02683667 0.0116146  0.04567584 0.07687095 0.00971865
 0.02307953 0.01166547 0.01061552 0.02120402 0.04475057 0.02235503
 0.01699443 0.01009425 0.04475057 0.02235503 0.01699443 0.03097938
 0.01061552 0.01029388 0.00538233 0.03400736 0.01065875 0.01426509
 0.05392581 0.02043796 0.02843417 0.03025029 0.01480784 0.01916964
 0.09178624]
[0.01248287 0.03135029 0.00866    0.02569341 0.05971608 0.0242974
 0.03841952 0.02563225 0.01551918 0.0506116  0.04107455 0.00956942
 0.02331055 0.01172574 0.01149919 0.02953275 0.04519702 0.02378534
 0.02010857 0.0078512  0.04519702 0.02378534 0.02010857 0.03576931
 0.01149919 0.01231429 0.0061015  0.03749445 0.01511355 0.01686917
 0.06015068 0.02503256 0.02255562 0.02940279 0.01676894 0.02065575
 0.08514433]
[0.01414567 0.03229432 0.01099611 0.02238992 0.04478478 0.02530277
 0.03174544 0.02436444 0.02158012 0.04983003 0.05374736 0.01180693
 0.02239004 0.01347291 0.0120612  0.0241102  0.05067362 0.02993996
 0.02183112 0.01056975 0.05067362 0.02993996 0.02183112 0.02663033
 0.0120612  0.01579908 0.00764272 0.03999232 0.01115794 0.0216893
 0.0524341  0.02523685 0.02471754 0.03065936 0.01822177 0.02479093
 0.05848521]
[0.01123756 0.03866958 0.00770501 0.02080791 0.04905115 0.02769908
 0.03983389 0.0247014  0.01269981 0.06291824 0.05492981 0.01055754
 0.02163799 0.01246339 0.00915767 0.02289824 0.04981772 0.02522794
 0.01885195 0.00851006 0.04981772 0.02522794 0.01885195 0.03250796
 0.00915767 0.01288773 0.00560759 0.03467702 0.01381206 0.01717952
 0.07011899 0.02501637 0.02052515 0.0314938  0.01225166 0.01970117
 0.07178974]
[0.02194364 0.03144591 0.01357368 0.03134036 0.03968399 0.03510071
 0.03530025 0.02724146 0.0232813  0.05031035 0.03625313 0.01276529
 0.02370653 0.01295142 0.01475936 0.03178214 0.02933143 0.02206255
 0.02330042 0.01407736 0.02933143 0.02206255 0.02330042 0.03200133
 0.01475936 0.01850836 0.01093929 0.02744917 0.01776731 0.02368301
 0.05817771 0.03274148 0.02973933 0.02856955 0.02494393 0.02000212
 0.05581234]]
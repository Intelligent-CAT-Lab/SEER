19533
Test: public void testComplexNamespace() throws Exception { String js = "var goog = {};" + "goog.foo = {};" + "goog.foo.bar = 5;"; TypeCheckResult p = parseAndTypeCheckWithScope(js); JSType googScopeType = p.scope.getVar("goog").getType(); Node varNode = p.root.getFirstChild(); JSType googNodeType = varNode.getFirstChild().getJSType(); Node getpropFoo1 = varNode.getNext().getFirstChild().getFirstChild(); JSType googGetpropFoo1Type = getpropFoo1.getFirstChild().getJSType(); JSType googFooType = ((ObjectType) googScopeType).getPropertyType("foo"); Node getpropFoo2 = varNode.getNext().getNext() .getFirstChild().getFirstChild().getFirstChild(); JSType googGetpropFoo2Type = getpropFoo2.getFirstChild().getJSType(); JSType googFooGetprop2Type = getpropFoo2.getJSType(); ObjectType googFooGetprop2ObjectType = (ObjectType) googFooGetprop2Type; }
Code: public JSType getPropertyType(String name) { if ("prototype".equals(name)) { return getPrototype(); } else { if (!hasOwnProperty(name)) { if ("call".equals(name)) { Node params = getParametersNode(); if (true) { defineDeclaredProperty(name, new FunctionType(registry, null, null, null, getReturnType()), false); } else { params = params.cloneTree(); Node thisTypeNode = Node.newString(Token.NAME, "thisType"); thisTypeNode.setJSType( registry.createOptionalNullableType(getTypeOfThis())); ; thisTypeNode.setOptionalArg(true); defineDeclaredProperty(name, new FunctionType(registry, null, null, params, getReturnType()), false); } } else if (true) { FunctionParamBuilder builder = new FunctionParamBuilder(registry); builder.addOptionalParams( registry.createNullableType(getTypeOfThis()), registry.createNullableType( registry.getNativeType(JSTypeNative.OBJECT_TYPE))); ; } } return super.getPropertyType(name); } }
tensor([[0.0075, 0.0189, 0.0072,  ..., 0.0104, 0.0032, 0.0032],
        [0.0049, 0.0223, 0.0083,  ..., 0.0074, 0.0025, 0.0025],
        [0.0067, 0.0186, 0.0092,  ..., 0.0099, 0.0032, 0.0032],
        ...,
        [0.0076, 0.0153, 0.0074,  ..., 0.0104, 0.0039, 0.0039],
        [0.0054, 0.0190, 0.0074,  ..., 0.0086, 0.0027, 0.0027],
        [0.0054, 0.0190, 0.0074,  ..., 0.0086, 0.0027, 0.0027]])
99171
Test: public void should_capture_varargs_as_vararg() throws Exception { mock.mixedVarargs(1, "a", "b"); Invocation invocation = getLastInvocation(); CapturingMatcher m = new CapturingMatcher(); InvocationMatcher invocationMatcher = new InvocationMatcher(invocation, (List) asList(new Equals(1), new LocalizedMatcher(m))); invocationMatcher.captureArgumentsFrom(invocation); }
Code: public void captureArgumentsFrom(Invocation invocation) { if (invocation.getMethod().isVarArgs()) { int indexOfVararg = invocation.getRawArguments().length - 1; for (int position = 0; position < indexOfVararg; position++) { Matcher m = matchers.get(position); if (m instanceof CapturesArguments) { ((CapturesArguments) m).captureFrom(invocation.getArgumentAt(position, Object.class)); } } for (int position = indexOfVararg; position < matchers.size(); position++) { Matcher m = matchers.get(position); if (m instanceof CapturesArguments) { ((CapturesArguments) m).captureFrom(invocation.getRawArguments()[position - indexOfVararg]); } } } else { for (int position = 0; position < matchers.size(); position++) { Matcher m = matchers.get(position); if (m instanceof CapturesArguments) { ((CapturesArguments) m).captureFrom(invocation.getArgumentAt(position, Object.class)); } } } }
tensor([[0.0087, 0.0070, 0.0182,  ..., 0.0037, 0.0037, 0.0037],
        [0.0075, 0.0062, 0.0286,  ..., 0.0036, 0.0036, 0.0036],
        [0.0099, 0.0063, 0.0209,  ..., 0.0037, 0.0037, 0.0037],
        ...,
        [0.0064, 0.0057, 0.0200,  ..., 0.0032, 0.0032, 0.0032],
        [0.0064, 0.0057, 0.0200,  ..., 0.0032, 0.0032, 0.0032],
        [0.0064, 0.0057, 0.0200,  ..., 0.0032, 0.0032, 0.0032]])
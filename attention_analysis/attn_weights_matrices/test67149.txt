67149
Test: public void testSimpleArrayRecovery() throws Exception { final String JSON = aposToQuotes("[{'a':3},{'a':27,'foo':[1,2],'b':{'x':3}} ,{'a':1,'b':2} ]"); MappingIterator<Bean> it = MAPPER.readerFor(Bean.class).readValues(JSON); Bean bean = it.nextValue(); try { it.nextValue(); } catch (JsonMappingException e) { verifyException(e, "Unrecognized field \"foo\""); } bean = it.nextValue(); it.close(); }
Code: public boolean hasNextValue() throws IOException { switch (_state) { case STATE_CLOSED: return false; case STATE_NEED_RESYNC: _resync(); case STATE_MAY_HAVE_VALUE: JsonToken t = _parser.getCurrentToken(); if (t == null) { t = _parser.nextToken(); if (t == null || t == JsonToken.END_ARRAY) { _state = STATE_CLOSED; if (_closeParser && (_parser != null)) { _parser.close(); } return false; } } _state = STATE_HAS_VALUE; return true; case STATE_HAS_VALUE: } return true; }
tensor([[0.0095, 0.0227, 0.0088,  ..., 0.0106, 0.0065, 0.0043],
        [0.0067, 0.0361, 0.0059,  ..., 0.0109, 0.0057, 0.0031],
        [0.0066, 0.0308, 0.0064,  ..., 0.0100, 0.0063, 0.0025],
        ...,
        [0.0061, 0.0295, 0.0063,  ..., 0.0088, 0.0048, 0.0034],
        [0.0078, 0.0377, 0.0076,  ..., 0.0103, 0.0075, 0.0032],
        [0.0067, 0.0242, 0.0076,  ..., 0.0144, 0.0090, 0.0035]])
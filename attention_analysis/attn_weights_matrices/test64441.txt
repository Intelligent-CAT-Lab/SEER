64441
Test: public void testUtf8StringsWithEscaping() throws Exception { List<byte[]> strings = generateStrings(new Random(28), 720000, true); ByteArrayOutputStream out = new ByteArrayOutputStream(16000); JsonFactory jf = new JsonFactory(); JsonGenerator jgen = jf.createGenerator(out, JsonEncoding.UTF8); jgen.writeStartArray(); for (byte[] str : strings) { jgen.writeUTF8String(str, 0, str.length); jgen.writeRaw('\n'); } jgen.writeEndArray(); jgen.close(); byte[] json = out.toByteArray(); JsonParser jp = jf.createParser(json); for (byte[] inputBytes : strings) { String string = jp.getText(); byte[] outputBytes = string.getBytes("UTF-8"); } jp.close(); }
Code: public void writeRaw(String text, int offset, int len){final char[] buf = _charBuffer;while (len > 0) {int len2 = Math.min(buf.length, len);text.getChars(offset, offset+len2, buf, 0);writeRaw(buf, -1, len2);;len -= len2;}}
[[0.02411295 0.02026173 0.01550674 0.029897   0.01404736 0.08524893
 0.01404736 0.05545967 0.00844432 0.02779793 0.01556056 0.03754083
 0.04653676 0.0383078  0.01500131 0.05427884 0.01807971 0.01556056
 0.03184256 0.04522645 0.09624197 0.06331737 0.05399095 0.05463009
 0.03492759 0.02886704 0.05526562]
[0.01720417 0.01665295 0.0153944  0.02519455 0.00861    0.09262227
 0.00861    0.06030668 0.00738217 0.02768907 0.01527507 0.03156119
 0.04003517 0.03275742 0.01348323 0.06233557 0.01860888 0.01527507
 0.0334828  0.05748382 0.09843806 0.08751819 0.05245702 0.03659468
 0.0423315  0.03007244 0.05262361]
[0.01826962 0.01406196 0.01691046 0.02518861 0.0102326  0.09347863
 0.0102326  0.06715001 0.00737157 0.02766733 0.01537812 0.04182835
 0.04677143 0.03981704 0.01749451 0.05111362 0.01674184 0.01537812
 0.03348272 0.04583303 0.09415866 0.07397666 0.05561096 0.05244142
 0.03587236 0.02684966 0.04668808]
[0.01708514 0.01295605 0.01758591 0.03209367 0.00944248 0.10088006
 0.00944248 0.0569158  0.00717887 0.03045533 0.01598006 0.03732499
 0.04863342 0.0325981  0.01508373 0.05742088 0.01472986 0.01598006
 0.03191291 0.03759507 0.08886205 0.07804377 0.05412312 0.04544596
 0.03187377 0.03499609 0.06536038]
[0.01508409 0.01403845 0.01428658 0.02225247 0.01000594 0.07042892
 0.01000594 0.06364769 0.0081318  0.02714435 0.01268971 0.03366579
 0.05616144 0.02760411 0.01293922 0.07695621 0.01496321 0.01268971
 0.03494852 0.05828364 0.08880403 0.09461577 0.05387737 0.05244869
 0.03718669 0.0267367  0.05040299]
[0.02816314 0.02174045 0.01622893 0.03229912 0.01405342 0.07461417
 0.01405342 0.06795222 0.00722322 0.03129897 0.01520959 0.02918701
 0.04282535 0.0429334  0.01608945 0.0673936  0.02158404 0.01520959
 0.03830123 0.04554125 0.08902235 0.0662229  0.05797077 0.04072362
 0.02622959 0.02642159 0.0515076 ]
[0.01508409 0.01403845 0.01428658 0.02225247 0.01000594 0.07042892
 0.01000594 0.06364769 0.0081318  0.02714435 0.01268971 0.03366579
 0.05616144 0.02760411 0.01293922 0.07695621 0.01496321 0.01268971
 0.03494852 0.05828364 0.08880403 0.09461577 0.05387737 0.05244869
 0.03718669 0.0267367  0.05040299]
[0.01695837 0.016188   0.01493934 0.02772471 0.00933642 0.09921245
 0.00933642 0.06163677 0.00660827 0.02864822 0.01551042 0.02850663
 0.04910698 0.02876565 0.01591692 0.06306443 0.01496209 0.01551042
 0.03629698 0.04751472 0.09623218 0.08575018 0.05136467 0.04669164
 0.02793209 0.02564463 0.06064037]
[0.01623705 0.01157609 0.01526412 0.0282539  0.00888848 0.13166589
 0.00888848 0.05698598 0.006749   0.02831185 0.01569781 0.03442689
 0.03735128 0.02860095 0.01251614 0.05010157 0.01563514 0.01569781
 0.0256562  0.03744426 0.08486185 0.08858456 0.06238616 0.0461718
 0.04540376 0.02493589 0.06170707]
[0.02526382 0.02326079 0.01956616 0.0327386  0.01162798 0.09626176
 0.01162798 0.05559778 0.00899033 0.03228854 0.01930452 0.02318412
 0.04326279 0.03762126 0.01947212 0.06202859 0.01795965 0.01930452
 0.03486099 0.05139514 0.07288755 0.06594628 0.05812374 0.03807972
 0.04011153 0.02368178 0.05555196]
[0.02824091 0.02326911 0.02214568 0.02666222 0.01688674 0.06771182
 0.01688674 0.0574879  0.01167234 0.04000275 0.02375297 0.03173296
 0.04660112 0.03799431 0.02155842 0.04908329 0.02280998 0.02375297
 0.04324577 0.05620832 0.06128722 0.05256633 0.04569857 0.0551755
 0.03485887 0.02899872 0.05370846]
[0.01660058 0.01231556 0.0164653  0.02971245 0.01005145 0.10243241
 0.01005145 0.06005464 0.00637138 0.02779305 0.01453722 0.03598658
 0.0517946  0.0338102  0.02104733 0.04893139 0.01587679 0.01453722
 0.02727001 0.05714468 0.09579705 0.08468194 0.04741017 0.04517276
 0.03345501 0.03035776 0.05034102]
[0.02127471 0.01608021 0.01536668 0.03073206 0.00987237 0.09389387
 0.00987237 0.07798148 0.00648479 0.03125363 0.0155268  0.03520505
 0.04705513 0.03555949 0.01592986 0.05806143 0.01321877 0.0155268
 0.03377975 0.05146609 0.0750004  0.09861045 0.04496266 0.04688082
 0.02561438 0.02776154 0.04702843]
[0.02452479 0.01627569 0.01718312 0.0281719  0.01057301 0.07932924
 0.01057301 0.06450634 0.00696609 0.02584034 0.01339595 0.03830487
 0.04433525 0.04374317 0.01303087 0.07231449 0.01619799 0.01339595
 0.03292864 0.04668148 0.0843069  0.07426455 0.05342635 0.05808297
 0.03013055 0.02684467 0.05467187]
[0.02023285 0.02193963 0.01851134 0.02947028 0.01166    0.08925915
 0.01166    0.0496817  0.00830714 0.03468907 0.01605503 0.02830816
 0.03971926 0.03440129 0.0154534  0.05250595 0.01910992 0.01605503
 0.04230382 0.04306045 0.08944392 0.08997073 0.05227031 0.04225576
 0.03770121 0.0280175  0.05795715]
[0.01659545 0.01471266 0.01355243 0.03199347 0.00890085 0.09916545
 0.00890085 0.04840405 0.00674744 0.03121135 0.01272533 0.03682671
 0.04185918 0.03543622 0.01354819 0.06414293 0.01227606 0.01272533
 0.0255177  0.04217158 0.10711525 0.09172848 0.05609692 0.04780522
 0.03418262 0.02364755 0.06201067]
[0.01738643 0.01724239 0.01514906 0.02731489 0.01090841 0.10225734
 0.01090841 0.06412002 0.00826239 0.02630166 0.01655813 0.03689922
 0.03718077 0.03718209 0.01440305 0.05596554 0.01879473 0.01655813
 0.02857646 0.04420377 0.12167329 0.0641216  0.04405016 0.04143755
 0.03105483 0.03558728 0.05590233]
[0.02824091 0.02326911 0.02214568 0.02666222 0.01688674 0.06771182
 0.01688674 0.0574879  0.01167234 0.04000275 0.02375297 0.03173296
 0.04660112 0.03799431 0.02155842 0.04908329 0.02280998 0.02375297
 0.04324577 0.05620832 0.06128722 0.05256633 0.04569857 0.0551755
 0.03485887 0.02899872 0.05370846]
[0.0262949  0.0290789  0.01808388 0.0357642  0.01423371 0.08753255
 0.01423371 0.06407592 0.0110101  0.02389635 0.01783413 0.03296613
 0.04359203 0.03989148 0.01594494 0.04728064 0.02544471 0.01783413
 0.03154416 0.05439516 0.08555952 0.07943472 0.03743707 0.02906807
 0.03014545 0.03623641 0.05118696]
[0.0205953  0.0135203  0.01568056 0.02600722 0.0090371  0.12345631
 0.0090371  0.05747401 0.0058855  0.02596912 0.01365145 0.02949807
 0.05839148 0.03540158 0.01235546 0.05752229 0.01347411 0.01365145
 0.03869967 0.04253187 0.08344013 0.07124063 0.05770092 0.05732916
 0.03445062 0.02289055 0.05110802]
[0.01945109 0.02003221 0.0147826  0.02405814 0.00777507 0.09868477
 0.00777507 0.06264778 0.00628245 0.03158771 0.01412451 0.02845272
 0.04031938 0.02866549 0.0124655  0.06631711 0.01390797 0.01412451
 0.03146555 0.05442773 0.10230054 0.07637588 0.05923949 0.04030566
 0.04014845 0.02595403 0.05832859]
[0.02062466 0.0152385  0.01619175 0.02650416 0.01001221 0.08731343
 0.01001221 0.07214482 0.00726951 0.02446575 0.01165641 0.04282967
 0.04886878 0.03780005 0.01415172 0.06938277 0.01291461 0.01165641
 0.02703866 0.05219833 0.09907843 0.06652302 0.05212111 0.05216243
 0.02663048 0.0304522  0.05475787]
[0.01778186 0.01849379 0.01607467 0.0302147  0.00826284 0.0954621
 0.00826284 0.05832902 0.00646751 0.03138037 0.01815572 0.04239866
 0.03799516 0.04286274 0.01157287 0.05899783 0.01763142 0.01815572
 0.03408194 0.04491344 0.09794134 0.06574596 0.0534058  0.0473959
 0.0287672  0.02993902 0.05930955]
[0.02365579 0.01664799 0.0170878  0.02721248 0.01019053 0.09353287
 0.01019053 0.06415285 0.00673298 0.03260744 0.01505808 0.03221246
 0.04664896 0.04371792 0.01992333 0.05286918 0.01695387 0.01505808
 0.03473441 0.05046159 0.08455192 0.07268555 0.04825857 0.04409236
 0.03667641 0.02695255 0.05713344]
[0.01985389 0.01901629 0.01552894 0.02323782 0.00912208 0.11258703
 0.00912208 0.06088429 0.00772728 0.02647018 0.01633599 0.036617
 0.05038119 0.02883956 0.01313155 0.05320322 0.01902545 0.01633599
 0.03641782 0.04793246 0.0923576  0.06303192 0.04267481 0.05300862
 0.0317099  0.03037932 0.06506779]
[0.02185555 0.01822998 0.01721622 0.02979293 0.01156324 0.08164845
 0.01156324 0.05703308 0.00871096 0.03142819 0.01588043 0.03883585
 0.05578818 0.03026309 0.01629724 0.05868612 0.01683998 0.01588043
 0.03993904 0.04578489 0.09907809 0.06613141 0.05265247 0.04293483
 0.02611041 0.03016809 0.05968747]
[0.01568639 0.01506816 0.01704821 0.02746468 0.01089011 0.09929758
 0.01089011 0.0705315  0.0081472  0.02760266 0.01344669 0.04159695
 0.0451366  0.03371713 0.01991955 0.04861883 0.01579892 0.01344669
 0.02743883 0.04962801 0.08218077 0.08167793 0.05102864 0.05969843
 0.03384386 0.02734324 0.05285231]]
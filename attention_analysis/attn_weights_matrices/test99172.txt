99172
Test: public void should_capture_varargs_as_vararg() throws Exception { mock.mixedVarargs(1, "a", "b"); Invocation invocation = getLastInvocation(); CapturingMatcher m = new CapturingMatcher(); InvocationMatcher invocationMatcher = new InvocationMatcher(invocation, (List) asList(new Equals(1), new LocalizedMatcher(m))); invocationMatcher.captureArgumentsFrom(invocation); }
Code: public void captureArgumentsFrom(Invocation invocation) { if (invocation.getMethod().isVarArgs()) { int indexOfVararg = invocation.getRawArguments().length - 1; for (int position = 0; position < indexOfVararg; position++) { Matcher m = matchers.get(position); if (m instanceof CapturesArguments) { ((CapturesArguments) m).captureFrom(invocation.getArgumentAt(position, Object.class)); } } for (Matcher m : uniqueMatcherSet(indexOfVararg)) { if (m instanceof CapturesArguments) { Object rawArgument = invocation.getRawArguments()[indexOfVararg]; for (int i = 0; i < Array.getLength(rawArgument); i++) { ((CapturesArguments) m).captureFrom(Array.get(rawArgument, i)); } } } } else { for (int position = 0; position < matchers.size(); position++) { Matcher m = matchers.get(position); if (m instanceof CapturesArguments) { ((CapturesArguments) m).captureFrom(invocation.getArgumentAt(position, Object.class)); } } } }
tensor([[0.0081, 0.0066, 0.0168,  ..., 0.0035, 0.0035, 0.0035],
        [0.0065, 0.0056, 0.0240,  ..., 0.0034, 0.0034, 0.0034],
        [0.0091, 0.0058, 0.0191,  ..., 0.0035, 0.0035, 0.0035],
        ...,
        [0.0060, 0.0054, 0.0185,  ..., 0.0031, 0.0031, 0.0031],
        [0.0060, 0.0054, 0.0185,  ..., 0.0031, 0.0031, 0.0031],
        [0.0060, 0.0054, 0.0185,  ..., 0.0031, 0.0031, 0.0031]])
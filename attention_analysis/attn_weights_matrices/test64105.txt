64105
Test: public void testExpand() { TextBuffer tb = new TextBuffer(new BufferRecycler()); char[] buf = tb.getCurrentSegment(); while (buf.length < 500 * 1000) { char[] old = buf; buf = tb.expandCurrentSegment(); if (old.length >= buf.length) { fail("Expected buffer of "+old.length+" to expand, did not, length now "+buf.length); } } }
Code: public char[] expandCurrentSegment(){final char[] curr = _currentSegment;final int len = curr.length;int newLen = (len == MAX_SEGMENT_LEN) ? (MAX_SEGMENT_LEN+-1) : Math.min(MAX_SEGMENT_LEN, len + (len >> -1));return (_currentSegment = Arrays.copyOf(curr, newLen));}
[[0.02343632 0.00799255 0.02748617 0.00799255 0.02700532 0.01501175
 0.05765289 0.01400169 0.0242448  0.01501175 0.02169655 0.04006955
 0.01501175 0.04564693 0.03578163 0.05287529 0.03785411 0.08291735
 0.02336807 0.03060527 0.0242448  0.01908438 0.04564693 0.03936874
 0.04493558 0.08914248 0.01501175 0.09058031 0.02632271]
[0.0159673  0.00636832 0.01545572 0.00636832 0.02056385 0.01527138
 0.04331484 0.00886813 0.0173966  0.01527138 0.0184646  0.03342622
 0.01527138 0.03671922 0.0316873  0.06268714 0.04017735 0.11752704
 0.01196631 0.03422404 0.0173966  0.01412931 0.03671922 0.03226881
 0.04734097 0.14698927 0.01527138 0.10438831 0.01849964]
[0.0206023  0.00930579 0.020873   0.00930579 0.02476127 0.01728274
 0.04212477 0.01211565 0.01888946 0.01728274 0.02124324 0.03293035
 0.01728274 0.04460975 0.03079772 0.05369005 0.04059888 0.08667655
 0.01461729 0.03644868 0.01888946 0.02211472 0.04460975 0.03490353
 0.04639569 0.11877935 0.01728274 0.10460733 0.02097866]
[0.0159673  0.00636832 0.01545572 0.00636832 0.02056385 0.01527138
 0.04331484 0.00886813 0.0173966  0.01527138 0.0184646  0.03342622
 0.01527138 0.03671922 0.0316873  0.06268714 0.04017735 0.11752704
 0.01196631 0.03422404 0.0173966  0.01412931 0.03671922 0.03226881
 0.04734097 0.14698927 0.01527138 0.10438831 0.01849964]
[0.01931132 0.00750086 0.02274592 0.00750086 0.02599862 0.01407818
 0.0418705  0.00993164 0.01797406 0.01407818 0.02252419 0.03286706
 0.01407818 0.04888957 0.02756311 0.05258652 0.04310088 0.10107876
 0.01494677 0.0305751  0.01797406 0.0144623  0.04888957 0.03332201
 0.05471851 0.12290265 0.01407818 0.10585789 0.01859456]
[0.02879171 0.01156485 0.02744015 0.01156485 0.03003273 0.02379547
 0.0465903  0.01745266 0.02354387 0.02379547 0.02526571 0.04283741
 0.02379547 0.04688774 0.03256407 0.05605261 0.03976396 0.07087597
 0.02442295 0.0339279  0.02354387 0.0254006  0.04688774 0.03227713
 0.03660598 0.0584182  0.02379547 0.08536398 0.02674112]
[0.02162821 0.00845004 0.02440303 0.00845004 0.02503649 0.01910277
 0.04712244 0.01281081 0.02363195 0.01910277 0.02848634 0.03799787
 0.01910277 0.06601235 0.02762513 0.05332618 0.04209892 0.08208822
 0.01879059 0.02536419 0.02363195 0.01664722 0.06601235 0.0353406
 0.04285749 0.07694389 0.01910277 0.08988641 0.01894606]
[0.01556813 0.00795654 0.01864107 0.00795654 0.01687333 0.01311181
 0.05266364 0.01074594 0.01856496 0.01311181 0.02075619 0.03618019
 0.01311181 0.05896937 0.03783651 0.05562863 0.04220019 0.08558165
 0.01781223 0.03069906 0.01856496 0.01821352 0.05896937 0.03544746
 0.04380252 0.11638717 0.01311181 0.10144992 0.02008358]
[0.01793026 0.00751594 0.02349731 0.00751594 0.02184233 0.01561747
 0.05464496 0.00998016 0.02005938 0.01561747 0.02103017 0.03115309
 0.01561747 0.04712022 0.02381456 0.04747588 0.04141993 0.08092211
 0.01751222 0.03208044 0.02005938 0.01715336 0.04712022 0.03682094
 0.04618746 0.14333253 0.01561747 0.10431317 0.01702819]
[0.02879171 0.01156485 0.02744015 0.01156485 0.03003273 0.02379547
 0.0465903  0.01745266 0.02354387 0.02379547 0.02526571 0.04283741
 0.02379547 0.04688774 0.03256407 0.05605261 0.03976396 0.07087597
 0.02442295 0.0339279  0.02354387 0.0254006  0.04688774 0.03227713
 0.03660598 0.0584182  0.02379547 0.08536398 0.02674112]
[0.01851531 0.00768671 0.02192321 0.00768671 0.02259839 0.01950007
 0.05883681 0.01418917 0.02148881 0.01950007 0.02318699 0.03342617
 0.01950007 0.04315311 0.03405857 0.0549593  0.03945672 0.08812423
 0.0182451  0.03458307 0.02148881 0.02122952 0.04315311 0.03428984
 0.0444247  0.10389326 0.01950008 0.08861016 0.02279193]
[0.02105943 0.00752076 0.02501161 0.00752076 0.02233974 0.01415686
 0.04798659 0.01008638 0.02497835 0.01415686 0.02440969 0.03504382
 0.01415686 0.04956372 0.03133657 0.04930972 0.04390106 0.09088098
 0.01732129 0.03396732 0.02497835 0.01852696 0.04956372 0.03276286
 0.03938104 0.10626829 0.01415686 0.10853008 0.02112345]
[0.02879171 0.01156485 0.02744015 0.01156485 0.03003273 0.02379547
 0.0465903  0.01745266 0.02354387 0.02379547 0.02526571 0.04283741
 0.02379547 0.04688774 0.03256407 0.05605261 0.03976396 0.07087597
 0.02442295 0.0339279  0.02354387 0.0254006  0.04688774 0.03227713
 0.03660598 0.0584182  0.02379547 0.08536398 0.02674112]
[0.0213799  0.00629978 0.02059251 0.00629978 0.02344487 0.01560159
 0.04341092 0.01030052 0.01741691 0.01560159 0.02342679 0.03767233
 0.01560159 0.0482294  0.02309489 0.04590953 0.05521281 0.07931016
 0.01844033 0.02888166 0.01741691 0.01992267 0.0482294  0.03713079
 0.04823817 0.11610866 0.01560159 0.12149313 0.01973077]
[0.01253375 0.00542721 0.01447627 0.00542721 0.01737625 0.01323602
 0.04795755 0.00736477 0.01936742 0.01323602 0.01963945 0.02888065
 0.01323602 0.04845098 0.03033762 0.05285839 0.03425718 0.08593774
 0.01793742 0.02947017 0.01936742 0.01718521 0.04845098 0.03691716
 0.04504492 0.14725633 0.01323603 0.13943851 0.01569537]
[0.02097803 0.00744094 0.02419752 0.00744094 0.0220648  0.0152258
 0.05548691 0.01203189 0.01962413 0.0152258  0.02124957 0.03292162
 0.0152258  0.04694158 0.02972492 0.04571642 0.03760231 0.08925806
 0.02132082 0.02502294 0.01962413 0.02030576 0.04694158 0.03575148
 0.03352617 0.13680355 0.0152258  0.10774314 0.01937761]
[0.01816302 0.00551197 0.01999124 0.00551197 0.01994524 0.01224117
 0.04998109 0.00766218 0.0174592  0.01224117 0.01641396 0.0287283
 0.01224117 0.05126313 0.02191011 0.04637825 0.03521894 0.08301896
 0.02167225 0.02655801 0.0174592  0.01654359 0.05126313 0.03514771
 0.04033083 0.1470097  0.01224117 0.14985847 0.0180349 ]
[0.01935085 0.00945717 0.02014977 0.00945717 0.0242042  0.01379837
 0.05305507 0.00910614 0.02137428 0.01379837 0.02455726 0.03374741
 0.01379837 0.05063526 0.0281099  0.04563076 0.03465436 0.07846089
 0.02255267 0.03146195 0.02137428 0.02098455 0.05063526 0.03283733
 0.03555292 0.12325041 0.01379837 0.12119512 0.02301154]
[0.02399969 0.00953477 0.02220841 0.00953477 0.03344249 0.01880505
 0.0454137  0.01471004 0.01996886 0.01880505 0.02193871 0.03822488
 0.01880505 0.0389214  0.02885134 0.0629718  0.05062026 0.0795904
 0.01708961 0.03438126 0.01996886 0.02122049 0.0389214  0.04153296
 0.04612802 0.08508582 0.01880504 0.09162004 0.02889984]
[0.02036425 0.00841333 0.02169282 0.00841333 0.02681408 0.01523623
 0.05102622 0.01167745 0.02682038 0.01523623 0.02312214 0.04511449
 0.01523623 0.03879639 0.03673049 0.05204602 0.03956733 0.08692539
 0.01888749 0.02823049 0.02682038 0.02353635 0.03879639 0.04529445
 0.04788779 0.09945978 0.01523623 0.09291197 0.01970594]
[0.01793026 0.00751594 0.02349731 0.00751594 0.02184233 0.01561747
 0.05464496 0.00998016 0.02005938 0.01561747 0.02103017 0.03115309
 0.01561747 0.04712022 0.02381456 0.04747588 0.04141993 0.08092211
 0.01751222 0.03208044 0.02005938 0.01715336 0.04712022 0.03682094
 0.04618746 0.14333253 0.01561747 0.10431317 0.01702819]
[0.0219705  0.00795512 0.02007885 0.00795512 0.02452832 0.01595727
 0.04984581 0.01167032 0.02235584 0.01595727 0.01785766 0.03538867
 0.01595727 0.05189067 0.02803937 0.05059522 0.0481566  0.08208016
 0.01625958 0.03663181 0.02235584 0.01885791 0.05189067 0.03397656
 0.04675107 0.09994873 0.01595727 0.11100063 0.01812982]
[0.0213799  0.00629978 0.02059251 0.00629978 0.02344487 0.01560159
 0.04341092 0.01030052 0.01741691 0.01560159 0.02342679 0.03767233
 0.01560159 0.0482294  0.02309489 0.04590953 0.05521281 0.07931016
 0.01844033 0.02888166 0.01741691 0.01992267 0.0482294  0.03713079
 0.04823817 0.11610866 0.01560159 0.12149313 0.01973077]
[0.02437005 0.01177998 0.02548252 0.01177998 0.02393566 0.0146908
 0.04878124 0.01123735 0.02011226 0.0146908  0.02325434 0.03325909
 0.0146908  0.05013054 0.03164262 0.05275328 0.0450909  0.07909736
 0.01946568 0.03310083 0.02011226 0.02136755 0.05013054 0.03035521
 0.03609649 0.12190145 0.0146908  0.09470252 0.02129708]
[0.02131489 0.00672263 0.02515795 0.00672263 0.02094833 0.0169077
 0.05849787 0.01159669 0.01972816 0.0169077  0.02178931 0.03289751
 0.0169077  0.05259319 0.03104048 0.05511837 0.03867279 0.08566745
 0.01915386 0.03525539 0.01972816 0.01777134 0.05259319 0.03451842
 0.04370214 0.09767656 0.0169077  0.10297465 0.02052726]
[0.02321382 0.00831646 0.02197487 0.00831646 0.02311902 0.01732566
 0.04578509 0.01272341 0.02087097 0.01732566 0.0262925  0.03281834
 0.01732566 0.04296129 0.02977256 0.05550423 0.04120504 0.08816653
 0.01911481 0.03729355 0.02087097 0.02004249 0.04296129 0.04549287
 0.04636431 0.10247996 0.01732567 0.09115078 0.02388572]
[0.02879171 0.01156485 0.02744015 0.01156485 0.03003273 0.02379547
 0.0465903  0.01745266 0.02354387 0.02379547 0.02526571 0.04283741
 0.02379547 0.04688774 0.03256407 0.05605261 0.03976396 0.07087597
 0.02442295 0.0339279  0.02354387 0.0254006  0.04688774 0.03227713
 0.03660598 0.0584182  0.02379547 0.08536398 0.02674112]
[0.0237469  0.0057611  0.01952491 0.0057611  0.02045593 0.01436198
 0.04923    0.00978234 0.01782212 0.01436198 0.02063006 0.03609463
 0.01436198 0.04353315 0.03581005 0.05182881 0.03554963 0.1040723
 0.01394047 0.02704689 0.01782212 0.01685569 0.04353315 0.03939795
 0.04122518 0.13476148 0.01436198 0.10517172 0.02319441]
[0.01861167 0.00653348 0.01736764 0.00653348 0.02245198 0.01394342
 0.05212631 0.01253107 0.019528   0.01394342 0.0203191  0.03096556
 0.01394342 0.046375   0.03611737 0.05205166 0.03953978 0.10965593
 0.01902853 0.03180508 0.019528   0.01760172 0.046375   0.04018717
 0.04559716 0.10336798 0.01394342 0.10608257 0.0239451 ]]
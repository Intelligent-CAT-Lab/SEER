62585
Test: public void testListTypeVariableWildcardField() throws Exception { Type listType = new TypeToken<List<Integer>>() {}.getType(); Field f = obj.getClass().getField("listWithTypeVariableWildcard"); TypeInfo typeInfo = TypeInfoFactory.getTypeInfoForField(f, OBJ_TYPE); }
Code: private static Type getActualType( Type typeToEvaluate, Type parentType, Class<?> rawParentClass) { if (typeToEvaluate instanceof Class<?>) { return typeToEvaluate; } else if (typeToEvaluate instanceof ParameterizedType) { ParameterizedType castedType = (ParameterizedType) typeToEvaluate; Type owner = castedType.getOwnerType(); Type[] actualTypeParameters = extractRealTypes(castedType.getActualTypeArguments(), parentType, rawParentClass); Type rawType = castedType.getRawType(); return new ParameterizedTypeImpl(rawType, actualTypeParameters, owner); } else if (typeToEvaluate instanceof GenericArrayType) { GenericArrayType castedType = (GenericArrayType) typeToEvaluate; Type componentType = castedType.getGenericComponentType(); Type actualType = getActualType(componentType, parentType, rawParentClass); if (componentType.equals(actualType)) { return castedType; } return actualType instanceof Class<?> ? TypeUtils.wrapWithArray(TypeUtils.toRawClass(actualType)) : new GenericArrayTypeImpl(actualType); } else if (typeToEvaluate instanceof TypeVariable<?>) { if (parentType instanceof ParameterizedType) { TypeVariable<?> fieldTypeVariable = (TypeVariable<?>) typeToEvaluate; TypeVariable<?>[] classTypeVariables = rawParentClass.getTypeParameters(); ParameterizedType objParameterizedType = (ParameterizedType) parentType; int indexOfActualTypeArgument = getIndex(classTypeVariables, fieldTypeVariable); Type[] actualTypeArguments = objParameterizedType.getActualTypeArguments(); return actualTypeArguments[indexOfActualTypeArgument]; } throw new UnsupportedOperationException("Expecting parameterized type, got " + parentType + ".\n Are you missing the use of TypeToken idiom?\n See " + "http: } else if (typeToEvaluate instanceof WildcardType) { WildcardType castedType = (WildcardType) typeToEvaluate; return getActualType(castedType.getUpperBounds()[0], parentType, rawParentClass); } else { throw new IllegalArgumentException("Type \'" + typeToEvaluate + "\' is not a Class, " + "ParameterizedType, GenericArrayType or TypeVariable. Can't extract type."); } }
tensor([[0.0053, 0.0081, 0.0021,  ..., 0.0068, 0.0017, 0.0017],
        [0.0041, 0.0104, 0.0024,  ..., 0.0053, 0.0019, 0.0019],
        [0.0044, 0.0124, 0.0024,  ..., 0.0059, 0.0013, 0.0013],
        ...,
        [0.0057, 0.0117, 0.0021,  ..., 0.0050, 0.0010, 0.0010],
        [0.0041, 0.0113, 0.0021,  ..., 0.0060, 0.0015, 0.0015],
        [0.0041, 0.0113, 0.0021,  ..., 0.0060, 0.0015, 0.0015]])
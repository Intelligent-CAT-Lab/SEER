63864
Test: public void testExpand() { TextBuffer tb = new TextBuffer(new BufferRecycler()); char[] buf = tb.getCurrentSegment(); while (buf.length < 500 * 1000) { char[] old = buf; buf = tb.expandCurrentSegment(); if (old.length >= buf.length) { fail("Expected buffer of "+old.length+" to expand, did not, length now "+buf.length); } } }
Code: public char[] expandCurrentSegment() { final char[] curr = _currentSegment; final int len = curr.length; int newLen = (len == MAX_SEGMENT_LEN) ? (MAX_SEGMENT_LEN+1) : Math.min(MAX_SEGMENT_LEN, len + (len >> 1)); return (_currentSegment = Arrays.copyOf(curr, newLen)); }
tensor([[0.0231, 0.0080, 0.0213,  ..., 0.0863, 0.0426, 0.0110],
        [0.0162, 0.0070, 0.0162,  ..., 0.0982, 0.0509, 0.0071],
        [0.0217, 0.0081, 0.0173,  ..., 0.1048, 0.0487, 0.0079],
        ...,
        [0.0229, 0.0057, 0.0223,  ..., 0.0960, 0.0562, 0.0080],
        [0.0241, 0.0076, 0.0239,  ..., 0.0780, 0.0556, 0.0111],
        [0.0165, 0.0078, 0.0190,  ..., 0.1040, 0.0444, 0.0099]])
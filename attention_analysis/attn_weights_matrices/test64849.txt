64849
Test: public void testThousandsOfSymbolsWithChars() throws IOException { final int SEED = 33333; CharsToNameCanonicalizer symbolsCRoot = CharsToNameCanonicalizer.createRoot(SEED); int exp = 0; for (int doc = 0; doc < 100; ++doc) { CharsToNameCanonicalizer symbolsC = symbolsCRoot.makeChild(JsonFactory.Feature.collectDefaults()); for (int i = 0; i < 250; ++i) { String name = "f_"+doc+"_"+i; char[] ch = name.toCharArray(); String str = symbolsC.findSymbol(ch, 0, ch.length, symbolsC.calcHash(name)); } symbolsC.release(); exp += 250; if (exp > CharsToNameCanonicalizer.MAX_ENTRIES_FOR_REUSE) { exp = 0; } } }
Code: public int calcHash(int q1) { int hash = q1 ^ _seed; hash += (hash >>> 16); ; hash += (hash >>> 12); return hash; }
tensor([[0.0236, 0.0136, 0.0474, 0.0104, 0.0379, 0.0136, 0.0684, 0.0153, 0.0743,
         0.0354, 0.0462, 0.0684, 0.0428, 0.0859, 0.0187, 0.0403, 0.0135, 0.0684,
         0.0428, 0.0859, 0.0187, 0.0565, 0.0268, 0.0336, 0.0115],
        [0.0151, 0.0100, 0.0600, 0.0111, 0.0393, 0.0100, 0.0598, 0.0127, 0.0724,
         0.0295, 0.0379, 0.0598, 0.0450, 0.0893, 0.0193, 0.0483, 0.0123, 0.0598,
         0.0450, 0.0893, 0.0193, 0.0858, 0.0250, 0.0357, 0.0080],
        [0.0281, 0.0124, 0.0483, 0.0160, 0.0552, 0.0124, 0.0649, 0.0199, 0.0576,
         0.0298, 0.0509, 0.0649, 0.0526, 0.0708, 0.0227, 0.0335, 0.0139, 0.0649,
         0.0526, 0.0708, 0.0227, 0.0354, 0.0409, 0.0487, 0.0100],
        [0.0255, 0.0101, 0.0460, 0.0128, 0.0351, 0.0101, 0.0530, 0.0164, 0.0694,
         0.0298, 0.0496, 0.0530, 0.0464, 0.1067, 0.0249, 0.0382, 0.0137, 0.0530,
         0.0464, 0.1067, 0.0249, 0.0521, 0.0326, 0.0344, 0.0093],
        [0.0281, 0.0128, 0.0442, 0.0178, 0.0514, 0.0128, 0.0617, 0.0236, 0.0561,
         0.0352, 0.0468, 0.0617, 0.0424, 0.0809, 0.0208, 0.0424, 0.0157, 0.0617,
         0.0424, 0.0809, 0.0208, 0.0437, 0.0315, 0.0473, 0.0171],
        [0.0151, 0.0100, 0.0600, 0.0111, 0.0393, 0.0100, 0.0598, 0.0127, 0.0724,
         0.0295, 0.0379, 0.0598, 0.0450, 0.0893, 0.0193, 0.0483, 0.0123, 0.0598,
         0.0450, 0.0893, 0.0193, 0.0858, 0.0250, 0.0357, 0.0080],
        [0.0270, 0.0142, 0.0449, 0.0144, 0.0385, 0.0142, 0.0661, 0.0180, 0.0676,
         0.0329, 0.0440, 0.0661, 0.0468, 0.0740, 0.0238, 0.0376, 0.0124, 0.0661,
         0.0468, 0.0740, 0.0238, 0.0635, 0.0284, 0.0438, 0.0108],
        [0.0301, 0.0176, 0.0468, 0.0167, 0.0376, 0.0176, 0.0583, 0.0260, 0.0653,
         0.0352, 0.0539, 0.0583, 0.0412, 0.0699, 0.0279, 0.0376, 0.0189, 0.0583,
         0.0412, 0.0699, 0.0279, 0.0448, 0.0337, 0.0496, 0.0156],
        [0.0146, 0.0058, 0.0444, 0.0105, 0.0375, 0.0058, 0.0669, 0.0102, 0.0761,
         0.0292, 0.0331, 0.0669, 0.0546, 0.1106, 0.0133, 0.0448, 0.0066, 0.0669,
         0.0546, 0.1106, 0.0133, 0.0587, 0.0231, 0.0362, 0.0054],
        [0.0198, 0.0074, 0.0479, 0.0098, 0.0460, 0.0074, 0.0573, 0.0132, 0.0696,
         0.0298, 0.0372, 0.0573, 0.0538, 0.0925, 0.0199, 0.0338, 0.0087, 0.0573,
         0.0538, 0.0925, 0.0199, 0.0720, 0.0337, 0.0527, 0.0067],
        [0.0167, 0.0094, 0.0537, 0.0125, 0.0398, 0.0094, 0.0575, 0.0112, 0.0715,
         0.0316, 0.0453, 0.0575, 0.0424, 0.1094, 0.0142, 0.0417, 0.0102, 0.0575,
         0.0424, 0.1094, 0.0142, 0.0676, 0.0220, 0.0446, 0.0079],
        [0.0270, 0.0142, 0.0449, 0.0144, 0.0385, 0.0142, 0.0661, 0.0180, 0.0676,
         0.0329, 0.0440, 0.0661, 0.0468, 0.0740, 0.0238, 0.0376, 0.0124, 0.0661,
         0.0468, 0.0740, 0.0238, 0.0635, 0.0284, 0.0438, 0.0108],
        [0.0219, 0.0107, 0.0477, 0.0132, 0.0496, 0.0107, 0.0729, 0.0134, 0.0627,
         0.0304, 0.0324, 0.0729, 0.0520, 0.0753, 0.0220, 0.0414, 0.0110, 0.0729,
         0.0520, 0.0753, 0.0220, 0.0527, 0.0212, 0.0547, 0.0090],
        [0.0213, 0.0099, 0.0471, 0.0080, 0.0353, 0.0099, 0.0614, 0.0132, 0.0837,
         0.0299, 0.0484, 0.0614, 0.0515, 0.0902, 0.0183, 0.0369, 0.0093, 0.0614,
         0.0515, 0.0902, 0.0183, 0.0782, 0.0216, 0.0350, 0.0078],
        [0.0191, 0.0088, 0.0497, 0.0118, 0.0364, 0.0088, 0.0592, 0.0149, 0.0581,
         0.0275, 0.0425, 0.0592, 0.0481, 0.1024, 0.0172, 0.0390, 0.0087, 0.0592,
         0.0481, 0.1024, 0.0172, 0.0762, 0.0306, 0.0434, 0.0116],
        [0.0250, 0.0093, 0.0466, 0.0118, 0.0466, 0.0093, 0.0626, 0.0129, 0.0622,
         0.0275, 0.0497, 0.0626, 0.0366, 0.1096, 0.0182, 0.0327, 0.0113, 0.0626,
         0.0366, 0.1096, 0.0182, 0.0568, 0.0258, 0.0465, 0.0095],
        [0.0145, 0.0087, 0.0673, 0.0112, 0.0502, 0.0087, 0.0500, 0.0130, 0.0715,
         0.0328, 0.0399, 0.0500, 0.0451, 0.0922, 0.0169, 0.0445, 0.0095, 0.0500,
         0.0451, 0.0922, 0.0169, 0.0854, 0.0289, 0.0494, 0.0060],
        [0.0270, 0.0142, 0.0449, 0.0144, 0.0385, 0.0142, 0.0661, 0.0180, 0.0676,
         0.0329, 0.0440, 0.0661, 0.0468, 0.0740, 0.0238, 0.0376, 0.0124, 0.0661,
         0.0468, 0.0740, 0.0238, 0.0635, 0.0284, 0.0438, 0.0108],
        [0.0219, 0.0107, 0.0477, 0.0132, 0.0496, 0.0107, 0.0729, 0.0134, 0.0627,
         0.0304, 0.0324, 0.0729, 0.0520, 0.0753, 0.0220, 0.0414, 0.0110, 0.0729,
         0.0520, 0.0753, 0.0220, 0.0527, 0.0212, 0.0547, 0.0090],
        [0.0213, 0.0099, 0.0471, 0.0080, 0.0353, 0.0099, 0.0614, 0.0132, 0.0837,
         0.0299, 0.0484, 0.0614, 0.0515, 0.0902, 0.0183, 0.0369, 0.0093, 0.0614,
         0.0515, 0.0902, 0.0183, 0.0782, 0.0216, 0.0350, 0.0078],
        [0.0191, 0.0088, 0.0497, 0.0118, 0.0364, 0.0088, 0.0592, 0.0149, 0.0581,
         0.0275, 0.0425, 0.0592, 0.0481, 0.1024, 0.0172, 0.0390, 0.0087, 0.0592,
         0.0481, 0.1024, 0.0172, 0.0762, 0.0306, 0.0434, 0.0116],
        [0.0211, 0.0124, 0.0464, 0.0119, 0.0520, 0.0124, 0.0668, 0.0132, 0.0596,
         0.0249, 0.0445, 0.0668, 0.0362, 0.1103, 0.0221, 0.0333, 0.0120, 0.0668,
         0.0362, 0.1103, 0.0221, 0.0416, 0.0242, 0.0417, 0.0113],
        [0.0163, 0.0086, 0.0520, 0.0101, 0.0378, 0.0086, 0.0551, 0.0163, 0.0729,
         0.0271, 0.0396, 0.0551, 0.0549, 0.1057, 0.0208, 0.0337, 0.0097, 0.0551,
         0.0549, 0.1057, 0.0208, 0.0676, 0.0227, 0.0390, 0.0101],
        [0.0235, 0.0101, 0.0506, 0.0142, 0.0401, 0.0101, 0.0629, 0.0145, 0.0599,
         0.0386, 0.0423, 0.0629, 0.0536, 0.0814, 0.0179, 0.0381, 0.0112, 0.0629,
         0.0536, 0.0814, 0.0179, 0.0669, 0.0248, 0.0494, 0.0110],
        [0.0169, 0.0127, 0.0466, 0.0145, 0.0456, 0.0127, 0.0682, 0.0155, 0.0724,
         0.0277, 0.0477, 0.0682, 0.0415, 0.0643, 0.0167, 0.0526, 0.0133, 0.0682,
         0.0415, 0.0643, 0.0167, 0.0686, 0.0375, 0.0563, 0.0097]])
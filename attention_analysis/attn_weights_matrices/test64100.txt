64100
Test: public void testExpand() { TextBuffer tb = new TextBuffer(new BufferRecycler()); char[] buf = tb.getCurrentSegment(); while (buf.length < 500 * 1000) { char[] old = buf; buf = tb.expandCurrentSegment(); if (old.length >= buf.length) { fail("Expected buffer of "+old.length+" to expand, did not, length now "+buf.length); } } }
Code: public char[] expandCurrentSegment(){final char[] curr = _currentSegment;final int len = curr.length;int newLen = (len == MAX_SEGMENT_LEN) ? (MAX_SEGMENT_LEN+1) : Math.min(MAX_SEGMENT_LEN, len + (len >> 0));return (_currentSegment = Arrays.copyOf(curr, newLen));}
tensor([[0.0249, 0.0085, 0.0292, 0.0085, 0.0288, 0.0160, 0.0615, 0.0148, 0.0258,
         0.0160, 0.0232, 0.0426, 0.0160, 0.0484, 0.0379, 0.0564, 0.0399, 0.0469,
         0.0250, 0.0327, 0.0258, 0.0203, 0.0484, 0.0419, 0.0273, 0.0940, 0.0160,
         0.0953, 0.0281],
        [0.0177, 0.0075, 0.0174, 0.0075, 0.0237, 0.0172, 0.0497, 0.0096, 0.0196,
         0.0172, 0.0216, 0.0375, 0.0172, 0.0408, 0.0346, 0.0733, 0.0424, 0.0485,
         0.0138, 0.0407, 0.0196, 0.0160, 0.0408, 0.0357, 0.0286, 0.1539, 0.0172,
         0.1097, 0.0209],
        [0.0220, 0.0101, 0.0223, 0.0101, 0.0266, 0.0185, 0.0451, 0.0129, 0.0202,
         0.0185, 0.0229, 0.0351, 0.0185, 0.0476, 0.0327, 0.0576, 0.0429, 0.0506,
         0.0157, 0.0394, 0.0202, 0.0237, 0.0476, 0.0372, 0.0261, 0.1248, 0.0185,
         0.1100, 0.0225],
        [0.0177, 0.0075, 0.0174, 0.0075, 0.0237, 0.0172, 0.0497, 0.0096, 0.0196,
         0.0172, 0.0216, 0.0375, 0.0172, 0.0408, 0.0346, 0.0733, 0.0424, 0.0485,
         0.0138, 0.0407, 0.0196, 0.0160, 0.0408, 0.0357, 0.0286, 0.1539, 0.0172,
         0.1097, 0.0209],
        [0.0208, 0.0084, 0.0249, 0.0084, 0.0289, 0.0153, 0.0464, 0.0107, 0.0197,
         0.0153, 0.0251, 0.0359, 0.0153, 0.0532, 0.0298, 0.0582, 0.0456, 0.0543,
         0.0167, 0.0344, 0.0197, 0.0158, 0.0532, 0.0361, 0.0306, 0.1295, 0.0153,
         0.1122, 0.0203],
        [0.0298, 0.0120, 0.0284, 0.0120, 0.0311, 0.0247, 0.0483, 0.0181, 0.0244,
         0.0247, 0.0262, 0.0443, 0.0247, 0.0486, 0.0337, 0.0581, 0.0411, 0.0446,
         0.0253, 0.0352, 0.0244, 0.0263, 0.0486, 0.0334, 0.0311, 0.0605, 0.0247,
         0.0883, 0.0277],
        [0.0229, 0.0089, 0.0258, 0.0089, 0.0265, 0.0202, 0.0499, 0.0135, 0.0250,
         0.0202, 0.0302, 0.0402, 0.0202, 0.0698, 0.0292, 0.0564, 0.0445, 0.0500,
         0.0199, 0.0268, 0.0250, 0.0176, 0.0698, 0.0374, 0.0244, 0.0813, 0.0202,
         0.0950, 0.0200],
        [0.0166, 0.0086, 0.0198, 0.0086, 0.0181, 0.0139, 0.0562, 0.0113, 0.0198,
         0.0139, 0.0223, 0.0386, 0.0139, 0.0625, 0.0399, 0.0597, 0.0443, 0.0473,
         0.0191, 0.0331, 0.0198, 0.0193, 0.0625, 0.0376, 0.0296, 0.1222, 0.0139,
         0.1063, 0.0213],
        [0.0190, 0.0082, 0.0252, 0.0082, 0.0236, 0.0167, 0.0589, 0.0105, 0.0214,
         0.0167, 0.0228, 0.0332, 0.0167, 0.0501, 0.0253, 0.0511, 0.0432, 0.0479,
         0.0188, 0.0348, 0.0214, 0.0184, 0.0501, 0.0393, 0.0262, 0.1490, 0.0167,
         0.1085, 0.0182],
        [0.0298, 0.0120, 0.0284, 0.0120, 0.0311, 0.0247, 0.0483, 0.0181, 0.0244,
         0.0247, 0.0262, 0.0443, 0.0247, 0.0486, 0.0337, 0.0581, 0.0411, 0.0446,
         0.0253, 0.0352, 0.0244, 0.0263, 0.0486, 0.0334, 0.0311, 0.0605, 0.0247,
         0.0883, 0.0277],
        [0.0196, 0.0082, 0.0233, 0.0082, 0.0240, 0.0206, 0.0624, 0.0150, 0.0228,
         0.0206, 0.0248, 0.0355, 0.0206, 0.0459, 0.0358, 0.0588, 0.0415, 0.0521,
         0.0194, 0.0371, 0.0228, 0.0225, 0.0459, 0.0362, 0.0296, 0.1089, 0.0206,
         0.0930, 0.0242],
        [0.0225, 0.0081, 0.0267, 0.0081, 0.0240, 0.0151, 0.0516, 0.0107, 0.0267,
         0.0151, 0.0264, 0.0374, 0.0151, 0.0526, 0.0332, 0.0530, 0.0459, 0.0515,
         0.0187, 0.0368, 0.0267, 0.0198, 0.0526, 0.0348, 0.0248, 0.1111, 0.0151,
         0.1134, 0.0226],
        [0.0298, 0.0120, 0.0284, 0.0120, 0.0311, 0.0247, 0.0483, 0.0181, 0.0244,
         0.0247, 0.0262, 0.0443, 0.0247, 0.0486, 0.0337, 0.0581, 0.0411, 0.0446,
         0.0253, 0.0352, 0.0244, 0.0263, 0.0486, 0.0334, 0.0311, 0.0605, 0.0247,
         0.0883, 0.0277],
        [0.0228, 0.0067, 0.0219, 0.0067, 0.0250, 0.0166, 0.0463, 0.0109, 0.0186,
         0.0166, 0.0250, 0.0401, 0.0166, 0.0513, 0.0245, 0.0490, 0.0584, 0.0448,
         0.0197, 0.0309, 0.0186, 0.0212, 0.0513, 0.0395, 0.0283, 0.1226, 0.0166,
         0.1282, 0.0210],
        [0.0136, 0.0060, 0.0158, 0.0060, 0.0191, 0.0144, 0.0523, 0.0079, 0.0211,
         0.0144, 0.0217, 0.0315, 0.0144, 0.0525, 0.0327, 0.0583, 0.0362, 0.0375,
         0.0198, 0.0325, 0.0211, 0.0187, 0.0525, 0.0400, 0.0274, 0.1549, 0.0144,
         0.1462, 0.0172],
        [0.0222, 0.0079, 0.0256, 0.0079, 0.0234, 0.0161, 0.0588, 0.0127, 0.0208,
         0.0161, 0.0226, 0.0348, 0.0161, 0.0496, 0.0313, 0.0485, 0.0396, 0.0485,
         0.0226, 0.0266, 0.0208, 0.0215, 0.0496, 0.0378, 0.0245, 0.1440, 0.0161,
         0.1134, 0.0205],
        [0.0196, 0.0061, 0.0217, 0.0061, 0.0219, 0.0133, 0.0543, 0.0082, 0.0188,
         0.0133, 0.0179, 0.0312, 0.0133, 0.0553, 0.0236, 0.0508, 0.0373, 0.0420,
         0.0239, 0.0293, 0.0188, 0.0181, 0.0553, 0.0381, 0.0171, 0.1545, 0.0133,
         0.1572, 0.0197],
        [0.0210, 0.0102, 0.0177, 0.0102, 0.0250, 0.0134, 0.0412, 0.0108, 0.0259,
         0.0134, 0.0212, 0.0395, 0.0134, 0.0521, 0.0305, 0.0509, 0.0466, 0.0491,
         0.0180, 0.0388, 0.0259, 0.0201, 0.0521, 0.0394, 0.0289, 0.1200, 0.0134,
         0.1306, 0.0206],
        [0.0251, 0.0100, 0.0232, 0.0100, 0.0351, 0.0197, 0.0476, 0.0154, 0.0209,
         0.0197, 0.0230, 0.0400, 0.0197, 0.0407, 0.0302, 0.0660, 0.0528, 0.0506,
         0.0179, 0.0361, 0.0209, 0.0222, 0.0407, 0.0435, 0.0346, 0.0887, 0.0197,
         0.0955, 0.0303],
        [0.0216, 0.0092, 0.0231, 0.0092, 0.0289, 0.0163, 0.0546, 0.0123, 0.0287,
         0.0163, 0.0250, 0.0481, 0.0163, 0.0416, 0.0387, 0.0566, 0.0412, 0.0512,
         0.0204, 0.0308, 0.0287, 0.0249, 0.0416, 0.0480, 0.0305, 0.1031, 0.0163,
         0.0957, 0.0210],
        [0.0190, 0.0082, 0.0252, 0.0082, 0.0236, 0.0167, 0.0589, 0.0105, 0.0214,
         0.0167, 0.0228, 0.0332, 0.0167, 0.0501, 0.0253, 0.0511, 0.0432, 0.0479,
         0.0188, 0.0348, 0.0214, 0.0184, 0.0501, 0.0393, 0.0262, 0.1490, 0.0167,
         0.1085, 0.0182],
        [0.0235, 0.0086, 0.0215, 0.0086, 0.0265, 0.0171, 0.0535, 0.0124, 0.0240,
         0.0171, 0.0193, 0.0380, 0.0171, 0.0554, 0.0299, 0.0545, 0.0511, 0.0418,
         0.0175, 0.0396, 0.0240, 0.0203, 0.0554, 0.0364, 0.0271, 0.1058, 0.0171,
         0.1175, 0.0195],
        [0.0228, 0.0067, 0.0219, 0.0067, 0.0250, 0.0166, 0.0463, 0.0109, 0.0186,
         0.0166, 0.0250, 0.0401, 0.0166, 0.0513, 0.0245, 0.0490, 0.0584, 0.0448,
         0.0197, 0.0309, 0.0186, 0.0212, 0.0513, 0.0395, 0.0283, 0.1226, 0.0166,
         0.1282, 0.0210],
        [0.0257, 0.0125, 0.0268, 0.0125, 0.0253, 0.0155, 0.0512, 0.0118, 0.0212,
         0.0155, 0.0246, 0.0349, 0.0155, 0.0527, 0.0331, 0.0558, 0.0470, 0.0446,
         0.0207, 0.0352, 0.0212, 0.0225, 0.0527, 0.0318, 0.0267, 0.1266, 0.0155,
         0.0984, 0.0224],
        [0.0256, 0.0124, 0.0242, 0.0124, 0.0282, 0.0189, 0.0460, 0.0164, 0.0288,
         0.0189, 0.0239, 0.0398, 0.0189, 0.0479, 0.0375, 0.0528, 0.0445, 0.0422,
         0.0272, 0.0356, 0.0288, 0.0245, 0.0479, 0.0406, 0.0252, 0.0799, 0.0189,
         0.0975, 0.0346],
        [0.0248, 0.0090, 0.0235, 0.0090, 0.0249, 0.0186, 0.0489, 0.0135, 0.0224,
         0.0186, 0.0284, 0.0350, 0.0186, 0.0459, 0.0317, 0.0599, 0.0436, 0.0458,
         0.0207, 0.0404, 0.0224, 0.0215, 0.0459, 0.0487, 0.0297, 0.1083, 0.0186,
         0.0962, 0.0256],
        [0.0298, 0.0120, 0.0284, 0.0120, 0.0311, 0.0247, 0.0483, 0.0181, 0.0244,
         0.0247, 0.0262, 0.0443, 0.0247, 0.0486, 0.0337, 0.0581, 0.0411, 0.0446,
         0.0253, 0.0352, 0.0244, 0.0263, 0.0486, 0.0334, 0.0311, 0.0605, 0.0247,
         0.0883, 0.0277],
        [0.0254, 0.0063, 0.0208, 0.0063, 0.0221, 0.0155, 0.0530, 0.0104, 0.0191,
         0.0155, 0.0224, 0.0384, 0.0155, 0.0463, 0.0381, 0.0561, 0.0372, 0.0598,
         0.0150, 0.0295, 0.0191, 0.0180, 0.0463, 0.0422, 0.0326, 0.1398, 0.0155,
         0.1090, 0.0250],
        [0.0204, 0.0073, 0.0189, 0.0073, 0.0250, 0.0152, 0.0574, 0.0134, 0.0214,
         0.0152, 0.0227, 0.0338, 0.0152, 0.0506, 0.0390, 0.0579, 0.0420, 0.0517,
         0.0213, 0.0356, 0.0214, 0.0193, 0.0506, 0.0438, 0.0295, 0.1099, 0.0152,
         0.1123, 0.0265]])
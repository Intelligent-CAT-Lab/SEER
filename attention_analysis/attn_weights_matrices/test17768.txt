17768
Test: public void testMotionPreservesOriginalSourceName() { String f = "function f(){}"; String g = "function g(){}"; String m0_before = f + g; String m1_before = ""; JSModule[] modules = CompilerTestCase.createModules(m0_before, m1_before); Compiler compiler = compilerFor(modules); Node root = root(compiler); Node externsRoot = externs(root); Node mainRoot = main(root); String m0_after = f; String m1_after = g; Node nodeG = mainRoot.getFirstChild().getLastChild(); mainRoot.getFirstChild().removeChild(nodeG); mainRoot.getLastChild().addChildrenToBack(nodeG.cloneTree()); FunctionInformationMap.Builder expected = FunctionInformationMap.newBuilder(); expected.addEntry( FunctionInformationMap.Entry.newBuilder() .setId(0) .setSourceName("i0") .setLineNumber(1) .setModuleName("m0") .setSize(g.length()) .setName("f") .setCompiledSource(f).build()); expected.addEntry( FunctionInformationMap.Entry.newBuilder() .setId(1) .setSourceName("i0") .setLineNumber(1) .setModuleName("m1") .setSize(g.length()) .setName("g") .setCompiledSource(g).build()); expected.addModule( FunctionInformationMap.Module.newBuilder() .setName("m0") .setCompiledSource(m0_after + ";").build()); expected.addModule( FunctionInformationMap.Module.newBuilder() .setName("m1") .setCompiledSource(m1_after + ";").build()); test(compiler, externsRoot, mainRoot, expected.build()); }
Code: * public static void main(String[] args) { * MyCommandLineRunner runner = new MyCommandLineRunner(args); * if (runner.shouldRunCompiler()) { * runner.run(); * } else { * System.exit(-1); * } * }
[[0.02579045 0.02811238 0.08246997 0.01554585 0.15190393 0.06556409
 0.03724384 0.02579045 0.04500607 0.02899345 0.01430304 0.0093496
 0.01255006 0.02579045 0.07300374 0.03026623 0.03724384 0.02579045
 0.02941865 0.02579045 0.00754616 0.05149396 0.03724384 0.02579045
 0.02132538 0.02579045 0.00754616 0.02579045 0.00754616]
[0.01978574 0.02881446 0.08419092 0.02316819 0.13759258 0.04981568
 0.03730943 0.01978574 0.05847865 0.03843877 0.01805975 0.01460948
 0.01754384 0.01978574 0.07755484 0.04157717 0.03730943 0.01978574
 0.0384455  0.01978574 0.01203383 0.04258237 0.03730943 0.01978574
 0.02281196 0.01978574 0.01203383 0.01978574 0.01203382]
[0.01820007 0.02897276 0.07507017 0.01859985 0.12926981 0.04961364
 0.0488652  0.01820007 0.05122136 0.04536767 0.01874242 0.01243125
 0.01830495 0.01820007 0.07872821 0.04025831 0.0488652  0.01820007
 0.03618523 0.01820007 0.01341759 0.04026057 0.0488652  0.01820007
 0.02452482 0.01820008 0.01341759 0.01820008 0.01341759]
[0.01756452 0.0220708  0.0763061  0.01900582 0.17315175 0.07175747
 0.03727975 0.01756452 0.05759574 0.02938646 0.01777416 0.01003908
 0.01602574 0.01756452 0.07324483 0.03968392 0.03727975 0.01756452
 0.03228795 0.01756452 0.01139411 0.04672351 0.03727975 0.01756452
 0.02840887 0.01756452 0.01139411 0.01756452 0.01139411]
[0.015889   0.02709281 0.06005874 0.024568   0.14947091 0.06175859
 0.0477826  0.015889   0.04724327 0.03489763 0.01774118 0.01179148
 0.01590933 0.015889   0.07817588 0.0471409  0.0477826  0.015889
 0.03562817 0.015889   0.01248557 0.05148996 0.0477826  0.015889
 0.02911667 0.015889   0.01248557 0.015889   0.01248557]
[0.01953566 0.02107073 0.0975423  0.01706612 0.1519805  0.0809072
 0.03565405 0.01953566 0.04983126 0.03677399 0.01688733 0.01103016
 0.01297003 0.01953566 0.07989031 0.03508457 0.03565405 0.01953566
 0.0318367  0.01953566 0.00688885 0.04617715 0.03565405 0.01953566
 0.02703775 0.01953565 0.00688885 0.01953565 0.00688885]
[0.02580741 0.02884521 0.06446607 0.02477064 0.10624257 0.05181268
 0.04180056 0.02580741 0.05370045 0.03574353 0.02380664 0.01675719
 0.01988013 0.02580741 0.05028195 0.03416812 0.04180056 0.02580741
 0.03395394 0.02580741 0.01546884 0.0514061  0.04180056 0.02580741
 0.02589735 0.02580741 0.01546883 0.02580741 0.01546884]
[0.02579045 0.02811238 0.08246997 0.01554585 0.15190393 0.06556409
 0.03724384 0.02579045 0.04500607 0.02899345 0.01430304 0.0093496
 0.01255006 0.02579045 0.07300374 0.03026623 0.03724384 0.02579045
 0.02941865 0.02579045 0.00754616 0.05149396 0.03724384 0.02579045
 0.02132538 0.02579045 0.00754616 0.02579045 0.00754616]
[0.02139053 0.02205695 0.07675636 0.0159633  0.13279158 0.08670186
 0.0353273  0.02139053 0.0452005  0.04087703 0.01824898 0.01137074
 0.01746907 0.02139053 0.08192836 0.03295697 0.0353273  0.02139053
 0.04021937 0.02139053 0.00903242 0.04124348 0.0353273  0.02139053
 0.0320121  0.02139054 0.00903242 0.02139054 0.00903242]
[0.01889088 0.0224851  0.07366608 0.01841798 0.15187173 0.06901847
 0.03753551 0.01889088 0.05822257 0.03576209 0.02042951 0.01154118
 0.01729646 0.01889088 0.08619346 0.04680646 0.03753551 0.01889088
 0.02669222 0.01889088 0.00996381 0.038764   0.03753551 0.01889088
 0.0292078  0.01889088 0.00996381 0.01889088 0.0099638 ]
[0.02663125 0.03254024 0.07528996 0.02610283 0.07957695 0.04461971
 0.03460449 0.02663125 0.04529133 0.04460273 0.02636132 0.01519271
 0.02558281 0.02663125 0.0716054  0.04325212 0.03460449 0.02663125
 0.03639509 0.02663125 0.01543049 0.04156286 0.03460449 0.02663125
 0.02886894 0.02663125 0.01543049 0.02663125 0.01543049]
[0.01663787 0.0246408  0.07347877 0.02211141 0.13515776 0.05785576
 0.04382317 0.01663787 0.04627632 0.04094202 0.01978269 0.0161101
 0.01797705 0.01663787 0.08420604 0.03876621 0.04382317 0.01663787
 0.03542161 0.01663787 0.01278212 0.05522895 0.04382317 0.01663787
 0.02912569 0.01663787 0.01278212 0.01663787 0.01278211]
[0.01609805 0.01765233 0.10503855 0.01660779 0.1376528  0.08448033
 0.04616439 0.01609805 0.05247871 0.03469083 0.0143676  0.00884045
 0.01489761 0.01609805 0.08328743 0.03665694 0.04616439 0.01609805
 0.02996125 0.01609805 0.00721875 0.04667591 0.04616439 0.01609805
 0.02777759 0.01609805 0.00721875 0.01609805 0.00721875]
[0.02579045 0.02811238 0.08246997 0.01554585 0.15190393 0.06556409
 0.03724384 0.02579045 0.04500607 0.02899345 0.01430304 0.0093496
 0.01255006 0.02579045 0.07300374 0.03026623 0.03724384 0.02579045
 0.02941865 0.02579045 0.00754616 0.05149396 0.03724384 0.02579045
 0.02132538 0.02579045 0.00754616 0.02579045 0.00754616]
[0.01571907 0.01718611 0.10366476 0.01288227 0.15846813 0.10569177
 0.03567844 0.01571907 0.04814402 0.02928865 0.01341027 0.00663057
 0.01091969 0.01571907 0.09673357 0.02911107 0.03567844 0.01571907
 0.02125893 0.01571907 0.0054833  0.07114679 0.03567844 0.01571907
 0.02622553 0.01571907 0.0054833  0.01571907 0.0054833 ]
[0.02083886 0.02629168 0.06463346 0.02427233 0.12263399 0.06976815
 0.04685876 0.02083886 0.05744404 0.03770215 0.01804565 0.01500645
 0.02113521 0.02083886 0.06302194 0.03720444 0.04685876 0.02083886
 0.03174433 0.02083886 0.01187744 0.04521811 0.04685876 0.02083886
 0.0229586  0.02083886 0.01187744 0.02083886 0.01187744]
[0.02580741 0.02884521 0.06446607 0.02477064 0.10624257 0.05181268
 0.04180056 0.02580741 0.05370045 0.03574353 0.02380664 0.01675719
 0.01988013 0.02580741 0.05028195 0.03416812 0.04180056 0.02580741
 0.03395394 0.02580741 0.01546884 0.0514061  0.04180056 0.02580741
 0.02589735 0.02580741 0.01546883 0.02580741 0.01546884]
[0.02579045 0.02811238 0.08246997 0.01554585 0.15190393 0.06556409
 0.03724384 0.02579045 0.04500607 0.02899345 0.01430304 0.0093496
 0.01255006 0.02579045 0.07300374 0.03026623 0.03724384 0.02579045
 0.02941865 0.02579045 0.00754616 0.05149396 0.03724384 0.02579045
 0.02132538 0.02579045 0.00754616 0.02579045 0.00754616]
[0.02019238 0.02649233 0.07662547 0.01707506 0.1270102  0.07694614
 0.0410367  0.02019238 0.06032183 0.03462818 0.02045738 0.01227068
 0.0138657  0.02019238 0.08458085 0.03454942 0.0410367  0.02019238
 0.03199404 0.02019238 0.01065552 0.03897133 0.0410367  0.02019238
 0.02759569 0.02019238 0.01065552 0.02019238 0.01065552]
[0.02579045 0.02811238 0.08246997 0.01554585 0.15190393 0.06556409
 0.03724384 0.02579045 0.04500607 0.02899345 0.01430304 0.0093496
 0.01255006 0.02579045 0.07300374 0.03026623 0.03724384 0.02579045
 0.02941865 0.02579045 0.00754616 0.05149396 0.03724384 0.02579045
 0.02132538 0.02579045 0.00754616 0.02579045 0.00754616]
[0.02065021 0.02119187 0.08134103 0.01897573 0.09396078 0.07379194
 0.04759668 0.02065021 0.05153602 0.04296833 0.01841716 0.01184068
 0.01991085 0.02065021 0.08027823 0.03081139 0.04759668 0.02065021
 0.03414067 0.02065021 0.01057345 0.05412554 0.04759668 0.02065021
 0.02699769 0.0206502  0.01057345 0.0206502  0.01057345]
[0.0201188  0.02318686 0.07225482 0.01725223 0.16636188 0.06460817
 0.04095057 0.0201188  0.06081577 0.02931991 0.01673633 0.01255629
 0.01382573 0.0201188  0.07310446 0.03408943 0.04095057 0.0201188
 0.03073573 0.0201188  0.00876467 0.05160478 0.04095057 0.0201188
 0.02345154 0.0201188  0.00876468 0.0201188  0.00876467]
[0.02580741 0.02884521 0.06446607 0.02477064 0.10624257 0.05181268
 0.04180056 0.02580741 0.05370045 0.03574353 0.02380664 0.01675719
 0.01988013 0.02580741 0.05028195 0.03416812 0.04180056 0.02580741
 0.03395394 0.02580741 0.01546884 0.0514061  0.04180056 0.02580741
 0.02589735 0.02580741 0.01546883 0.02580741 0.01546884]
[0.02579045 0.02811238 0.08246997 0.01554585 0.15190393 0.06556409
 0.03724384 0.02579045 0.04500607 0.02899345 0.01430304 0.0093496
 0.01255006 0.02579045 0.07300374 0.03026623 0.03724384 0.02579045
 0.02941865 0.02579045 0.00754616 0.05149396 0.03724384 0.02579045
 0.02132538 0.02579045 0.00754616 0.02579045 0.00754616]
[0.01862724 0.02596526 0.07441092 0.02214948 0.10072868 0.06527001
 0.04623171 0.01862724 0.0481922  0.04903574 0.02058617 0.01704535
 0.02068727 0.01862724 0.07820185 0.03718998 0.04623171 0.01862724
 0.04094148 0.01862724 0.01388803 0.04213155 0.04623171 0.01862724
 0.02808698 0.01862724 0.01388803 0.01862724 0.01388803]
[0.02579045 0.02811238 0.08246997 0.01554585 0.15190393 0.06556409
 0.03724384 0.02579045 0.04500607 0.02899345 0.01430304 0.0093496
 0.01255006 0.02579045 0.07300374 0.03026623 0.03724384 0.02579045
 0.02941865 0.02579045 0.00754616 0.05149396 0.03724384 0.02579045
 0.02132538 0.02579045 0.00754616 0.02579045 0.00754616]
[0.02065021 0.02119187 0.08134103 0.01897573 0.09396078 0.07379194
 0.04759668 0.02065021 0.05153602 0.04296833 0.01841716 0.01184068
 0.01991085 0.02065021 0.08027823 0.03081139 0.04759668 0.02065021
 0.03414067 0.02065021 0.01057345 0.05412554 0.04759668 0.02065021
 0.02699769 0.0206502  0.01057345 0.0206502  0.01057345]
[0.02579045 0.02811238 0.08246997 0.01554585 0.15190393 0.06556409
 0.03724384 0.02579045 0.04500607 0.02899345 0.01430304 0.0093496
 0.01255006 0.02579045 0.07300374 0.03026623 0.03724384 0.02579045
 0.02941865 0.02579045 0.00754616 0.05149396 0.03724384 0.02579045
 0.02132538 0.02579045 0.00754616 0.02579045 0.00754616]
[0.02065021 0.02119187 0.08134101 0.01897573 0.09396079 0.07379194
 0.04759669 0.02065021 0.05153602 0.04296833 0.01841716 0.01184068
 0.01991085 0.02065021 0.08027822 0.03081139 0.04759669 0.02065021
 0.03414067 0.02065021 0.01057345 0.05412554 0.04759669 0.02065021
 0.02699769 0.02065021 0.01057345 0.02065021 0.01057345]]
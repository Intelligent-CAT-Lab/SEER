18269
Test: public void testOptimizationOrder() { final List<String> visitationLog = Lists.newArrayList(); AbstractPeepholeOptimization note1Applied = new AbstractPeepholeOptimization() { @Override public Node optimizeSubtree(Node node) { if (node.isName()) { visitationLog.add(node.getString() + "1"); } return node; } }; AbstractPeepholeOptimization note2Applied = new AbstractPeepholeOptimization() { @Override public Node optimizeSubtree(Node node) { if (node.isName()) { visitationLog.add(node.getString() + "2"); } return node; } }; currentPeepholePasses = ImmutableList.< AbstractPeepholeOptimization>of(note1Applied, note2Applied); test("var x; var y", "var x; var y"); }
Code: public Node optimizeSubtree(Node node){switch(node.getType()) {case Token.TRUE:case Token.FALSE:return reduceTrueFalse(node);case Token.NEW:node = tryFoldStandardConstructors(node);if (!node.isCall()) {return node;}case Token.CALL:Node result = tryFoldLiteralConstructor(node);if (result == node) {;if (result == node) {;}}return result;case Token.RETURN:return tryReduceReturn(node);case Token.COMMA:return trySplitComma(node);case Token.NAME:return tryReplaceUndefined(node);case Token.ARRAYLIT:return tryMinimizeArrayLiteral(node);default:return node; }}
[[0.01724313 0.03457057 0.01059268 0.03125463 0.05484536 0.02437134
 0.03396356 0.02573075 0.03424105 0.0110015  0.01702693 0.04862675
 0.05432833 0.01094863 0.02336546 0.01338556 0.0110015  0.02266563
 0.04715322 0.02651966 0.02274721 0.01066078 0.04715322 0.02651966
 0.02274721 0.0235644  0.00684675 0.02936765 0.00897167 0.01885219
 0.04396111 0.02893017 0.02589641 0.02904921 0.01908082 0.02316734
 0.05964797]
[0.01271637 0.03841971 0.01067297 0.02354452 0.048915   0.02686034
 0.04044009 0.02500536 0.03438728 0.01203778 0.0162078  0.06725844
 0.05606531 0.00973283 0.02090136 0.01490896 0.01203778 0.02250643
 0.03992337 0.02192549 0.02081975 0.00922517 0.03992337 0.02192549
 0.02081975 0.02529385 0.00697793 0.03354466 0.01593746 0.01541751
 0.0577349  0.03205292 0.02326561 0.02969591 0.01590564 0.0208021
 0.05619081]
[0.01458443 0.03082175 0.00829608 0.02586415 0.07494946 0.02558954
 0.04019447 0.03019461 0.03604661 0.01003449 0.01430333 0.05316028
 0.05390979 0.00904823 0.02307302 0.0135015  0.01003449 0.01841252
 0.03722434 0.0229457  0.02239551 0.00807973 0.03722434 0.0229457
 0.02239551 0.02711557 0.00576476 0.03134238 0.01040162 0.01769914
 0.04695568 0.02836189 0.02490663 0.03676301 0.01855472 0.02311793
 0.06378711]
[0.01271483 0.02937815 0.00869069 0.02148548 0.05438945 0.02978995
 0.03832878 0.02593939 0.03945761 0.00970351 0.01756846 0.07028601
 0.05149584 0.01094234 0.01860157 0.01070722 0.00970351 0.02394201
 0.05050689 0.01950126 0.02199093 0.00857528 0.05050689 0.01950126
 0.02199093 0.02568965 0.00523757 0.02854084 0.01051564 0.01565167
 0.06168224 0.02839807 0.02522749 0.0306309  0.01456792 0.02041539
 0.05774439]
[0.0121218  0.03464261 0.01020947 0.0225249  0.06515974 0.02691183
 0.04104203 0.03639151 0.02891523 0.00992521 0.02419861 0.04668669
 0.0431404  0.00880765 0.01968207 0.01194267 0.00992521 0.02183553
 0.04602607 0.02311506 0.02083581 0.00968545 0.04602607 0.02311506
 0.02083581 0.0252132  0.00545243 0.03943931 0.00915239 0.01586451
 0.05434906 0.03115223 0.02947618 0.0265958  0.01365481 0.02017747
 0.06577017]
[0.01814996 0.03488803 0.00962032 0.02571473 0.0449107  0.03172471
 0.03552376 0.02218947 0.03151484 0.01226162 0.01421142 0.0505847
 0.05616725 0.01383582 0.02599768 0.01309983 0.01226162 0.02461659
 0.04067018 0.02576856 0.02282887 0.00993766 0.04067018 0.02576856
 0.02282887 0.02792495 0.00720881 0.03262853 0.0158025  0.0222505
 0.05764558 0.02847483 0.02459448 0.02936871 0.01576133 0.02501629
 0.04757764]
[0.01411691 0.02870296 0.00748909 0.02707443 0.0654604  0.02723085
 0.0403963  0.02929935 0.03749245 0.01025056 0.01763558 0.05148967
 0.06033763 0.0109394  0.0219451  0.01117864 0.01025056 0.02289801
 0.0435122  0.01952284 0.01636207 0.00986462 0.0435122  0.01952284
 0.01636207 0.02178017 0.00553961 0.03034547 0.00914124 0.01600499
 0.06139293 0.02688664 0.0273592  0.03323535 0.01459888 0.01991194
 0.07095686]
[0.01572524 0.03325015 0.00983346 0.02177088 0.07045881 0.03007386
 0.04004598 0.02367443 0.03107199 0.01128108 0.01518787 0.05016697
 0.05049489 0.01008593 0.02297912 0.01234851 0.01128108 0.0254075
 0.04295639 0.02135421 0.02131622 0.0123606  0.04295639 0.02135421
 0.02131622 0.02604222 0.00794301 0.0331593  0.01309216 0.02011599
 0.05361476 0.0238624  0.03249449 0.03005518 0.02147321 0.01778031
 0.05161503]
[0.01113237 0.03645065 0.00655109 0.0227196  0.06202773 0.02227457
 0.03900452 0.02919498 0.02667521 0.00956253 0.01769862 0.04842576
 0.0626938  0.00864373 0.02033295 0.01233906 0.00956253 0.01888092
 0.04302777 0.0207089  0.02185974 0.00927784 0.04302777 0.0207089
 0.02185974 0.02308454 0.00536536 0.04514292 0.01174766 0.0132279
 0.05972128 0.02289768 0.02319634 0.03641876 0.01541343 0.02145297
 0.07768987]
[0.02115362 0.03238545 0.01201854 0.02315479 0.0361642  0.02408746
 0.02905161 0.03537529 0.03055455 0.01756253 0.01968415 0.04676775
 0.03985515 0.01359819 0.02424213 0.01295377 0.01756253 0.02675961
 0.03657244 0.02385357 0.02906787 0.01416165 0.03657244 0.02385357
 0.02906787 0.02918195 0.01147706 0.03917304 0.01477991 0.01895177
 0.04137723 0.02751074 0.0283089  0.03237926 0.0265397  0.02203774
 0.05220196]
[0.01239044 0.0377216  0.0097279  0.02338079 0.04584927 0.0266386
 0.03493338 0.02349128 0.03419866 0.01062394 0.01677206 0.06689253
 0.05545312 0.00979491 0.02033434 0.01083441 0.01062394 0.02361283
 0.05613035 0.02369938 0.02071816 0.01048195 0.05613035 0.02369938
 0.02071816 0.02498946 0.00786439 0.03667004 0.01338714 0.01406331
 0.0553403  0.02511901 0.02677906 0.02883442 0.01550939 0.02134382
 0.04524789]
[0.01869532 0.03210451 0.01068221 0.02500315 0.03626614 0.03166243
 0.03683276 0.02769002 0.03778022 0.01316047 0.01451587 0.04783718
 0.04729645 0.01127717 0.02277945 0.01097827 0.01316047 0.02959992
 0.04167344 0.0231959  0.02227066 0.01263657 0.04167344 0.0231959
 0.02227066 0.02531612 0.00859716 0.03428939 0.0130153  0.02004502
 0.06181829 0.02664145 0.02918382 0.02649969 0.01901064 0.02236466
 0.05897994]
[0.01250796 0.03264654 0.00914062 0.0252359  0.0532901  0.02663913
 0.04030944 0.02675182 0.03726448 0.01129049 0.01462142 0.05010176
 0.05323645 0.01057238 0.01895212 0.01185431 0.01129049 0.02478471
 0.05268779 0.01811824 0.02215057 0.01070953 0.05268779 0.01811824
 0.02215057 0.02067715 0.00707325 0.02950047 0.00949479 0.01754106
 0.05788672 0.02766466 0.02790595 0.02573493 0.02071649 0.02101157
 0.06768011]
[0.01505104 0.03351545 0.00843214 0.02603883 0.06787188 0.02737924
 0.03327437 0.02397191 0.0293726  0.00938853 0.01323775 0.05390436
 0.0508373  0.01038989 0.0204396  0.0133431  0.00938853 0.02540712
 0.04418789 0.02577698 0.0227228  0.00832026 0.04418789 0.02577698
 0.0227228  0.02536462 0.0058161  0.03232597 0.0098938  0.01970091
 0.05527759 0.03008931 0.02080761 0.04010766 0.01786728 0.01956025
 0.05824968]
[0.01349468 0.02837119 0.00771374 0.01903107 0.05920313 0.02826225
 0.03945671 0.02668911 0.0346568  0.01118325 0.01672909 0.04650337
 0.05615818 0.01080433 0.02113969 0.00854437 0.01118325 0.02655328
 0.05023059 0.01835791 0.02232928 0.01066192 0.05023059 0.01835791
 0.02232928 0.02482664 0.00682906 0.03982166 0.01128681 0.01664389
 0.05340701 0.02288915 0.02998554 0.02891085 0.01662342 0.01907997
 0.07152102]
[0.01858442 0.0381379  0.00881139 0.02117249 0.07275769 0.02579423
 0.03300808 0.02646752 0.03946899 0.00970186 0.01236643 0.04848523
 0.04801445 0.00985246 0.02224771 0.01349005 0.00970186 0.02172842
 0.04833195 0.01958976 0.02302104 0.01057193 0.04833195 0.01958976
 0.02302104 0.02416981 0.00590671 0.02908795 0.01147374 0.01681426
 0.05337164 0.0258276  0.02487375 0.03866838 0.01603166 0.02117848
 0.06034742]
[0.02115362 0.03238545 0.01201854 0.02315479 0.0361642  0.02408746
 0.02905161 0.03537529 0.03055455 0.01756253 0.01968415 0.04676775
 0.03985515 0.01359819 0.02424213 0.01295377 0.01756253 0.02675961
 0.03657244 0.02385357 0.02906787 0.01416165 0.03657244 0.02385357
 0.02906787 0.02918195 0.01147706 0.03917304 0.01477991 0.01895177
 0.04137723 0.02751074 0.0283089  0.03237926 0.0265397  0.02203774
 0.05220196]
[0.01659689 0.03415284 0.01007857 0.02553077 0.05439183 0.02879707
 0.03875846 0.03081359 0.03321171 0.01099539 0.02119257 0.05382261
 0.04305992 0.0102368  0.02030529 0.0125197  0.01099539 0.03012346
 0.04093066 0.02064075 0.02044993 0.01022931 0.04093066 0.02064075
 0.02044993 0.0262108  0.00622357 0.03170881 0.01191413 0.01560951
 0.05771238 0.03374374 0.02719513 0.03278697 0.01435269 0.02280817
 0.05987929]
[0.01600792 0.02992326 0.01103909 0.02333291 0.05152807 0.02903629
 0.04241588 0.02310214 0.03665293 0.01098579 0.01372539 0.04178503
 0.05372243 0.01233356 0.02543426 0.01264873 0.01098579 0.02974703
 0.04470969 0.02431781 0.02075383 0.01282667 0.04470969 0.02431781
 0.02075383 0.02934144 0.00898317 0.03301311 0.01268651 0.01873842
 0.05850032 0.02692861 0.02543355 0.02995748 0.01629973 0.02319619
 0.05012568]
[0.00851218 0.03205972 0.00734987 0.02097081 0.05684612 0.02452278
 0.04116862 0.02311633 0.04777685 0.00892863 0.01344245 0.07033245
 0.06186036 0.00755977 0.01930742 0.01135256 0.00892863 0.02054538
 0.0527231  0.02077384 0.01668327 0.0061327  0.0527231  0.02077384
 0.01668327 0.026598   0.00382496 0.03415024 0.00858321 0.01495648
 0.06769551 0.02709906 0.01806635 0.02998893 0.00948328 0.0195333
 0.06894663]
[0.01491536 0.03596829 0.00948028 0.0286947  0.06135486 0.03307914
 0.03813396 0.03017887 0.03955474 0.00967736 0.01807286 0.05253481
 0.04300607 0.01020228 0.02162693 0.01465999 0.00967736 0.02525103
 0.0475346  0.01840618 0.01834505 0.0089484  0.0475346  0.01840618
 0.01834505 0.02505222 0.00755844 0.03249977 0.01164468 0.01618293
 0.04992336 0.03128432 0.0306626  0.02597968 0.01527568 0.01934848
 0.06099898]
[0.01048553 0.03627692 0.00826086 0.0241274  0.06027052 0.02635203
 0.04139426 0.03207767 0.03174903 0.01033955 0.01596728 0.05801523
 0.05084007 0.01048438 0.02142726 0.0138326  0.01033955 0.02064336
 0.04376211 0.02022181 0.02017395 0.00987543 0.04376211 0.02022181
 0.02017395 0.02236784 0.00608498 0.03572614 0.01072888 0.0145936
 0.06487966 0.02635656 0.02765506 0.03317486 0.01699036 0.02049012
 0.0598773 ]
[0.01600792 0.02992326 0.01103909 0.02333291 0.05152807 0.02903629
 0.04241588 0.02310214 0.03665293 0.01098579 0.01372539 0.04178503
 0.05372243 0.01233356 0.02543426 0.01264873 0.01098579 0.02974703
 0.04470969 0.02431781 0.02075383 0.01282667 0.04470969 0.02431781
 0.02075383 0.02934144 0.00898317 0.03301311 0.01268651 0.01873842
 0.05850032 0.02692861 0.02543355 0.02995748 0.01629973 0.02319619
 0.05012568]
[0.00851218 0.03205972 0.00734987 0.02097081 0.05684612 0.02452278
 0.04116862 0.02311633 0.04777685 0.00892863 0.01344245 0.07033245
 0.06186036 0.00755977 0.01930742 0.01135256 0.00892863 0.02054538
 0.0527231  0.02077384 0.01668327 0.0061327  0.0527231  0.02077384
 0.01668327 0.026598   0.00382496 0.03415024 0.00858321 0.01495648
 0.06769551 0.02709906 0.01806635 0.02998893 0.00948328 0.0195333
 0.06894663]
[0.01491536 0.03596829 0.00948028 0.0286947  0.06135486 0.03307914
 0.03813396 0.03017887 0.03955474 0.00967736 0.01807286 0.05253481
 0.04300607 0.01020228 0.02162693 0.01465999 0.00967736 0.02525103
 0.0475346  0.01840618 0.01834505 0.0089484  0.0475346  0.01840618
 0.01834505 0.02505222 0.00755844 0.03249977 0.01164468 0.01618293
 0.04992336 0.03128432 0.0306626  0.02597968 0.01527568 0.01934848
 0.06099898]
[0.01672169 0.0297069  0.0091286  0.03400633 0.04993239 0.0291561
 0.03514738 0.02161208 0.03196216 0.01121599 0.0118475  0.06054201
 0.04359424 0.01006916 0.0238585  0.01574771 0.01121599 0.02363708
 0.03900965 0.02357246 0.02596229 0.00860878 0.03900965 0.02357246
 0.02596229 0.02980871 0.00682435 0.03414951 0.0139487  0.01852379
 0.04469018 0.03048957 0.02237873 0.02812357 0.02474    0.01884205
 0.07268146]
[0.01420374 0.03061005 0.00891132 0.02192068 0.0676942  0.02685138
 0.03635084 0.02739816 0.03475352 0.01075334 0.0194778  0.06046169
 0.0384925  0.00879024 0.01782781 0.01381096 0.01075334 0.02275335
 0.03977988 0.02379968 0.02099768 0.00798941 0.03977988 0.02379968
 0.02099768 0.02566682 0.00494005 0.03744773 0.01306953 0.01490388
 0.05999089 0.02921148 0.024152   0.03149361 0.01785168 0.01851461
 0.073799  ]
[0.01582621 0.03854784 0.01044112 0.02283079 0.05594694 0.02638873
 0.03985572 0.02852146 0.03398482 0.01063447 0.01525436 0.05333159
 0.05018126 0.01109295 0.02120177 0.01188155 0.01063447 0.02587026
 0.04512547 0.02417248 0.01851139 0.01064153 0.04512547 0.02417248
 0.01851139 0.02540793 0.00795152 0.0304587  0.01025499 0.01404004
 0.06043371 0.0243319  0.03167734 0.0268829  0.01828189 0.02034171
 0.06125079]
[0.01451538 0.03054556 0.00805322 0.0245986  0.05557163 0.02827842
 0.03979992 0.02647758 0.03706395 0.01010541 0.01170443 0.06035507
 0.05298848 0.00761187 0.01885932 0.01285394 0.01010541 0.02057831
 0.03962418 0.02001159 0.02059379 0.00982956 0.03962418 0.02001159
 0.02059379 0.02294642 0.00575473 0.03744471 0.01347659 0.01534017
 0.05947388 0.03307473 0.02312172 0.03842213 0.01438996 0.01958194
 0.07661785]
[0.01579193 0.03717109 0.01256965 0.02538856 0.04656672 0.03419954
 0.03479639 0.02583782 0.03886312 0.01529908 0.01762716 0.05144506
 0.05457215 0.01067683 0.02191446 0.01407203 0.01529908 0.03282863
 0.03794388 0.01889383 0.01641259 0.01226325 0.03794388 0.01889383
 0.01641259 0.02359101 0.00807341 0.02990241 0.01331908 0.01671196
 0.05620231 0.03188085 0.02507642 0.03556848 0.01566105 0.02563216
 0.05469775]
[0.01838168 0.0307946  0.00991502 0.0221477  0.05003228 0.03169069
 0.03860126 0.02164044 0.03158644 0.01066757 0.01619308 0.04206016
 0.05250797 0.01270005 0.0242831  0.01192102 0.01066757 0.02846384
 0.0415439  0.02356837 0.02518285 0.01203165 0.0415439  0.02356837
 0.02518285 0.02780183 0.00573688 0.03563137 0.01441636 0.01799039
 0.06331341 0.02507496 0.03028056 0.03144337 0.01897434 0.0185696
 0.05389062]
[0.01319037 0.03567506 0.00934123 0.02359252 0.06656216 0.02855437
 0.0314378  0.02248903 0.03497687 0.01136014 0.0107382  0.06404116
 0.05689511 0.00877884 0.02143032 0.00869835 0.01136014 0.02279233
 0.04810634 0.02268837 0.01880289 0.00946842 0.04810634 0.02268837
 0.01880289 0.02387809 0.00574388 0.0336476  0.00946688 0.01480768
 0.05730426 0.02686348 0.02306561 0.02828195 0.01713271 0.01557171
 0.07365847]
[0.01286798 0.03251521 0.00733035 0.02592276 0.06295475 0.0280373
 0.03738265 0.0263814  0.03327147 0.0104221  0.01673045 0.04605625
 0.07195406 0.00953123 0.0227139  0.01180458 0.0104221  0.02141345
 0.04623387 0.02206571 0.01660714 0.00971358 0.04623387 0.02206571
 0.01660714 0.02345757 0.00539497 0.03197501 0.00997923 0.01370572
 0.05261988 0.02027917 0.02740453 0.03092765 0.01405313 0.01824498
 0.08471926]
[0.01206645 0.02956283 0.00820845 0.02573277 0.06172564 0.024105
 0.03649832 0.02511689 0.03955555 0.01108827 0.01735169 0.05096231
 0.03854838 0.00923037 0.022614   0.01165785 0.01108827 0.02921954
 0.04625698 0.02336369 0.01971618 0.00757245 0.04625698 0.02336369
 0.01971618 0.0283852  0.00599669 0.03516663 0.01407462 0.01604506
 0.05958042 0.02475531 0.02177268 0.02964725 0.01591407 0.01958823
 0.0784951 ]
[0.01388552 0.03094436 0.01061941 0.02222325 0.04575593 0.02503166
 0.03076766 0.02379776 0.03379197 0.01184889 0.02002903 0.04983657
 0.05102489 0.01155712 0.02198387 0.0133154  0.01184889 0.02399895
 0.0514972  0.02943093 0.02151182 0.01026427 0.0514972  0.02943093
 0.02151182 0.02766047 0.00754964 0.03792099 0.01067507 0.02076731
 0.05139835 0.02506611 0.024162   0.03083028 0.0176844  0.02377467
 0.05510538]
[0.01079897 0.03572055 0.00719045 0.02062225 0.05083347 0.02737874
 0.03781051 0.02349164 0.0433363  0.00874286 0.01382176 0.06351967
 0.05067348 0.01022195 0.02104043 0.01232201 0.00874286 0.02264786
 0.05132311 0.02484809 0.01847822 0.00805124 0.05132311 0.02484809
 0.01847822 0.02644932 0.00546759 0.03200512 0.01269379 0.01618924
 0.06858032 0.02491675 0.01989127 0.03197666 0.0115449  0.01854979
 0.06546938]
[0.02182043 0.0311523  0.01342652 0.03167824 0.04071521 0.0350164
 0.03503675 0.02717386 0.03300615 0.01470065 0.01430832 0.05046084
 0.03563481 0.01278862 0.02365937 0.01300481 0.01470065 0.03200787
 0.02985842 0.02215908 0.02327434 0.01397671 0.02985842 0.02215908
 0.02327434 0.02767888 0.01094865 0.02700981 0.01742527 0.02338321
 0.05851055 0.03287457 0.02957056 0.02889463 0.02465397 0.01984253
 0.05435519]]
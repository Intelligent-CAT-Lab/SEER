64100
Test: public void testExpand() { TextBuffer tb = new TextBuffer(new BufferRecycler()); char[] buf = tb.getCurrentSegment(); while (buf.length < 500 * 1000) { char[] old = buf; buf = tb.expandCurrentSegment(); if (old.length >= buf.length) { fail("Expected buffer of "+old.length+" to expand, did not, length now "+buf.length); } } }
Code: public char[] expandCurrentSegment(){final char[] curr = _currentSegment;final int len = curr.length;int newLen = (len == MAX_SEGMENT_LEN) ? (MAX_SEGMENT_LEN+1) : Math.min(MAX_SEGMENT_LEN, len + (len >> 0));return (_currentSegment = Arrays.copyOf(curr, newLen));}
[[0.02490528 0.00854305 0.02915251 0.00854305 0.02876716 0.01597854
 0.06145963 0.01479893 0.02577965 0.01597854 0.02317218 0.04262163
 0.01597854 0.04841208 0.03790878 0.05643847 0.03985353 0.04691304
 0.0250029  0.03273235 0.02577965 0.02028982 0.04841208 0.04191803
 0.02725989 0.09402746 0.01597854 0.09532869 0.02806602]
[0.0177203  0.0074838  0.01741551 0.0074838  0.0237491  0.01720473
 0.04970413 0.00964437 0.01956459 0.01720473 0.02161279 0.03754279
 0.01720473 0.04076838 0.03455787 0.07331607 0.04237087 0.04849048
 0.01381606 0.04065255 0.01956459 0.01600606 0.04076838 0.03574922
 0.02863157 0.15394655 0.01720474 0.10969948 0.02092174]
[0.02201244 0.01005775 0.02233734 0.01005775 0.0265758  0.01850624
 0.04513962 0.01288337 0.02019958 0.01850624 0.0228871  0.03510717
 0.01850624 0.0476072  0.03274306 0.05762682 0.04287119 0.05063985
 0.01568601 0.03940648 0.02019958 0.02373874 0.0476072  0.03723615
 0.02611357 0.12477614 0.01850624 0.10999899 0.02246619]
[0.0177203  0.0074838  0.01741551 0.0074838  0.0237491  0.01720473
 0.04970413 0.00964437 0.01956459 0.01720473 0.02161279 0.03754279
 0.01720473 0.04076838 0.03455787 0.07331607 0.04237087 0.04849048
 0.01381606 0.04065255 0.01956459 0.01600606 0.04076838 0.03574922
 0.02863157 0.15394655 0.01720474 0.10969948 0.02092174]
[0.02075038 0.00839412 0.02492918 0.00839412 0.02890652 0.01533215
 0.04638466 0.01066485 0.01968285 0.01533215 0.02508203 0.03586753
 0.01533215 0.05324285 0.02978177 0.05818814 0.0455546  0.05434997
 0.01667022 0.03435424 0.01968285 0.01583135 0.05324285 0.03614263
 0.03057791 0.12948254 0.01533215 0.11216575 0.02034755]
[0.02980731 0.01198572 0.02841761 0.01198572 0.03111704 0.02465107
 0.04826377 0.01805917 0.02438446 0.02465107 0.02618898 0.04434551
 0.02465107 0.04856566 0.03369816 0.05808193 0.04113743 0.04464126
 0.02530486 0.0351723  0.02438446 0.02631037 0.04856566 0.03341449
 0.03113897 0.06045317 0.02465107 0.08828151 0.02769026]
[0.02288138 0.00894471 0.02581589 0.00894471 0.02649954 0.02020279
 0.04986404 0.01354541 0.02500828 0.02020279 0.03015983 0.04020358
 0.02020279 0.06984358 0.02921509 0.05644992 0.04450952 0.04997845
 0.01988741 0.02684919 0.02500828 0.01761139 0.06984358 0.03738365
 0.0243584  0.08133867 0.02020279 0.09499981 0.02004454]
[0.01655352 0.00856712 0.01982809 0.00856712 0.0180566  0.01393808
 0.05623112 0.01132338 0.01980864 0.01393808 0.02227005 0.03861668
 0.01393808 0.06245526 0.03993821 0.05968232 0.04433054 0.0473434
 0.01911231 0.03305162 0.01980864 0.01931098 0.06245526 0.03761859
 0.02960536 0.12215371 0.01393807 0.10625815 0.02130101]
[0.01898715 0.00816271 0.02519105 0.00816271 0.02357859 0.01671672
 0.05885018 0.01053339 0.02138252 0.01671672 0.0228032  0.03315175
 0.01671672 0.05009348 0.02527254 0.05112905 0.04321031 0.04785115
 0.01882822 0.03481309 0.02138252 0.0183518  0.05009348 0.03925727
 0.02624299 0.14903337 0.01671672 0.10853136 0.01823934]
[0.02980731 0.01198572 0.02841761 0.01198572 0.03111704 0.02465107
 0.04826377 0.01805917 0.02438446 0.02465107 0.02618898 0.04434551
 0.02465107 0.04856566 0.03369816 0.05808193 0.04113743 0.04464126
 0.02530486 0.0351723  0.02438446 0.02631037 0.04856566 0.03341449
 0.03113897 0.06045317 0.02465107 0.08828151 0.02769026]
[0.01960177 0.00820331 0.02330667 0.00820331 0.0240387  0.02063811
 0.0623732  0.01496352 0.02284066 0.02063811 0.02481121 0.03548203
 0.02063811 0.04588032 0.0357841  0.05877721 0.04153416 0.05212072
 0.01941896 0.03705303 0.02284066 0.02251567 0.04588032 0.0361632
 0.02959611 0.10886829 0.02063811 0.09303226 0.02415816]
[0.02249482 0.00813251 0.02669433 0.00813251 0.02399042 0.01507753
 0.05162386 0.01065857 0.02670622 0.01507753 0.02638292 0.0374132
 0.01507753 0.05262286 0.03321249 0.05297135 0.04593391 0.05154231
 0.01865925 0.0367657  0.02670622 0.01979022 0.05262286 0.03478907
 0.02477523 0.11111295 0.01507752 0.11335886 0.02259719]
[0.02980731 0.01198572 0.02841761 0.01198572 0.03111704 0.02465107
 0.04826377 0.01805917 0.02438446 0.02465107 0.02618898 0.04434551
 0.02465107 0.04856566 0.03369816 0.05808193 0.04113743 0.04464126
 0.02530486 0.0351723  0.02438446 0.02631037 0.04856566 0.03341449
 0.03113897 0.06045317 0.02465107 0.08828151 0.02769026]
[0.02277806 0.00674235 0.02194852 0.00674235 0.02504435 0.01662215
 0.04626258 0.01092067 0.01856439 0.01662215 0.02504869 0.04011174
 0.01662215 0.0512507  0.02450004 0.04898817 0.05843986 0.04480508
 0.01971445 0.0309024  0.01856439 0.02124644 0.0512507  0.03953007
 0.02825357 0.12263731 0.01662215 0.12824617 0.02101836]
[0.01357294 0.00601098 0.01578292 0.00601098 0.0190906  0.01440408
 0.05229019 0.00786163 0.02113224 0.01440408 0.02165467 0.03150345
 0.01440408 0.05248036 0.03265409 0.05831774 0.03624826 0.03745286
 0.0198302  0.03254585 0.02113224 0.01873528 0.05248036 0.03997869
 0.02740071 0.15487812 0.01440408 0.14617106 0.01716724]
[0.02215585 0.00790645 0.02562557 0.00790645 0.02339642 0.01612028
 0.05875206 0.01268743 0.0207717  0.01612028 0.02257847 0.03484319
 0.01612028 0.04961919 0.03134459 0.04851225 0.03959065 0.04852445
 0.02264656 0.02657763 0.0207717  0.02149365 0.04961919 0.03782728
 0.02445604 0.1440351  0.01612028 0.11336395 0.02051298]
[0.01962928 0.00607625 0.02170887 0.00607625 0.02188893 0.01333848
 0.05429683 0.00823526 0.01882127 0.01333848 0.01791888 0.0312384
 0.01333848 0.05525102 0.02360318 0.05084338 0.03728207 0.04200576
 0.02389489 0.02926305 0.01882127 0.01805067 0.05525102 0.03805315
 0.01711003 0.15445563 0.01333848 0.15718913 0.01968156]
[0.02103017 0.01021493 0.01772064 0.01021493 0.02497016 0.01341613
 0.04117612 0.01077366 0.02587666 0.01341613 0.02119376 0.03952443
 0.01341613 0.05209881 0.03046794 0.050938   0.04661897 0.04914206
 0.01798569 0.0388182  0.02587666 0.02010797 0.05209881 0.03938414
 0.02890514 0.11996362 0.01341612 0.13061513 0.02061889]
[0.02513657 0.01000392 0.02324452 0.01000392 0.03507881 0.01971689
 0.04756343 0.0153683  0.02090462 0.01971689 0.02299888 0.03997242
 0.01971689 0.04071461 0.03017029 0.06603413 0.05278065 0.05060269
 0.0179383  0.03612582 0.02090462 0.02221164 0.04071461 0.04351681
 0.03459488 0.08874042 0.01971689 0.09554506 0.03026253]
[0.02163872 0.00918749 0.02312529 0.00918749 0.02892016 0.01628871
 0.05461554 0.01225231 0.0286755  0.01628871 0.02502826 0.04814094
 0.01628871 0.04161562 0.03870656 0.05656931 0.04121174 0.05118906
 0.02041383 0.0307992  0.0286755  0.02489235 0.04161562 0.04800408
 0.03049453 0.10312524 0.01628871 0.09573182 0.02102893]
[0.01898715 0.00816271 0.02519105 0.00816271 0.02357859 0.01671672
 0.05885018 0.01053339 0.02138252 0.01671672 0.0228032  0.03315175
 0.01671672 0.05009348 0.02527254 0.05112905 0.04321031 0.04785115
 0.01882822 0.03481309 0.02138252 0.0183518  0.05009348 0.03925727
 0.02624299 0.14903337 0.01671672 0.10853136 0.01823934]
[0.02352081 0.00859629 0.02151994 0.00859629 0.02649327 0.01709897
 0.0535428  0.01243844 0.02396023 0.01709897 0.01926183 0.03799881
 0.01709897 0.05536439 0.02994555 0.05448949 0.05108543 0.04181533
 0.01752732 0.03959827 0.02396023 0.02027926 0.05536439 0.0363724
 0.02709513 0.10583173 0.01709897 0.11747756 0.01946888]
[0.02277806 0.00674235 0.02194852 0.00674235 0.02504435 0.01662215
 0.04626258 0.01092067 0.01856439 0.01662215 0.02504869 0.04011174
 0.01662215 0.0512507  0.02450004 0.04898817 0.05843986 0.04480508
 0.01971445 0.0309024  0.01856439 0.02124644 0.0512507  0.03953007
 0.02825357 0.12263731 0.01662215 0.12824617 0.02101836]
[0.02570981 0.01251574 0.0268293  0.01251574 0.02532243 0.01550605
 0.05119576 0.01178358 0.02117493 0.01550605 0.02459694 0.03494084
 0.01550605 0.05270036 0.03311534 0.05582662 0.04704262 0.04462128
 0.02065178 0.03515034 0.02117493 0.02247711 0.05270036 0.03183565
 0.02667314 0.12657751 0.01550605 0.09841076 0.02243309]
[0.02556735 0.01241723 0.02417723 0.01241723 0.02821439 0.01888192
 0.04600296 0.01642594 0.02884742 0.01888192 0.02391691 0.03983961
 0.01888192 0.04787245 0.03745195 0.05276595 0.04449557 0.04222324
 0.02718039 0.03555139 0.02884742 0.0245184  0.04787245 0.04063378
 0.02522091 0.07990596 0.01888192 0.09749086 0.03461533]
[0.02482444 0.00897528 0.02354357 0.00897528 0.02492094 0.01855583
 0.04892691 0.01351579 0.02243545 0.01855583 0.02839101 0.03503766
 0.01855583 0.0458722  0.03171979 0.05988786 0.0436074  0.04582861
 0.02065868 0.04042876 0.02243545 0.02145494 0.0458722  0.04870354
 0.02969946 0.10833206 0.01855583 0.0961601  0.02556932]
[0.02980731 0.01198572 0.02841761 0.01198572 0.03111704 0.02465107
 0.04826377 0.01805917 0.02438446 0.02465107 0.02618898 0.04434551
 0.02465107 0.04856566 0.03369816 0.05808193 0.04113743 0.04464126
 0.02530486 0.0351723  0.02438446 0.02631037 0.04856566 0.03341449
 0.03113897 0.06045317 0.02465107 0.08828151 0.02769026]
[0.02542932 0.00627521 0.02078747 0.00627521 0.02211434 0.01547224
 0.05297661 0.0103542  0.01910458 0.01547224 0.02242342 0.03844738
 0.01547224 0.04625337 0.03810694 0.05605797 0.03719131 0.0598281
 0.01502105 0.02949644 0.01910458 0.0180088  0.04625337 0.04221229
 0.03263672 0.13977349 0.01547224 0.10896082 0.02501806]
[0.02038784 0.00733095 0.01894095 0.00733095 0.02498679 0.0152363
 0.05741876 0.01344543 0.0213918  0.0152363  0.02272894 0.03378323
 0.0152363  0.05060194 0.03898831 0.05788052 0.04204714 0.05166547
 0.02133076 0.03557964 0.0213918  0.01930793 0.05060194 0.04376913
 0.02954939 0.1098588  0.0152363  0.11226701 0.02646943]]
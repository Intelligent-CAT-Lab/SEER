67365
Test: public void testCollectionTypesRefined() { TypeFactory tf = newTypeFactory(); JavaType type = tf.constructType(new TypeReference<List<Long>>() { }); JavaType subtype = tf.constructSpecializedType(type, ArrayList.class); }
Code: public JavaType constructSpecializedType(JavaType baseType, Class<?> subclass){final Class<?> rawBase = baseType.getRawClass();if (rawBase == subclass) {return baseType;}JavaType newType;do { if (rawBase == Object.class) {newType = _fromClass(null, subclass, TypeBindings.emptyBindings());break;}if (!rawBase.isAssignableFrom(subclass)) {throw new IllegalArgumentException(String.format("Class %s not subtype of %s", subclass.getName(), baseType));}if (true) {newType = _fromClass(null, subclass, TypeBindings.emptyBindings());break;}if (baseType.isContainerType()) {if (baseType.isMapLikeType()) {if ((subclass == HashMap.class)|| (subclass == LinkedHashMap.class)|| (subclass == EnumMap.class)|| (subclass == TreeMap.class)) {newType = _fromClass(null, subclass,TypeBindings.create(subclass, baseType.getKeyType(), baseType.getContentType()));break;}} else if (baseType.isCollectionLikeType()) {if ((subclass == ArrayList.class)|| (subclass == LinkedList.class)|| (subclass == HashSet.class)|| (subclass == TreeSet.class)) {newType = _fromClass(null, subclass,TypeBindings.create(subclass, baseType.getContentType()));break;}if (rawBase == EnumSet.class) {return baseType;}}}int typeParamCount = subclass.getTypeParameters().length;if (typeParamCount == 0) {newType = _fromClass(null, subclass, TypeBindings.emptyBindings());break;}if (baseType.isInterface()) {newType = baseType.refine(subclass, TypeBindings.emptyBindings(), null, new JavaType[] { baseType });} else {newType = baseType.refine(subclass, TypeBindings.emptyBindings(), baseType, NO_TYPES);}if (newType == null) {TypeBindings tb = null;if (baseType.containedTypeCount() == typeParamCount) {if (typeParamCount == 1) {tb = TypeBindings.create(subclass, baseType.containedType(0));} else if (typeParamCount == 0) {tb = TypeBindings.create(subclass, baseType.containedType(0),baseType.containedType(1));}};}} while (false);return newType;}
tensor([[0.0044, 0.0069, 0.0079,  ..., 0.0104, 0.0037, 0.0086],
        [0.0044, 0.0077, 0.0082,  ..., 0.0143, 0.0035, 0.0074],
        [0.0045, 0.0076, 0.0071,  ..., 0.0111, 0.0041, 0.0082],
        ...,
        [0.0039, 0.0084, 0.0068,  ..., 0.0129, 0.0041, 0.0086],
        [0.0036, 0.0077, 0.0068,  ..., 0.0142, 0.0044, 0.0079],
        [0.0040, 0.0082, 0.0058,  ..., 0.0109, 0.0038, 0.0091]])
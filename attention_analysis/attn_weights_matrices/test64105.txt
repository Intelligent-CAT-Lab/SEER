64105
Test: public void testExpand() { TextBuffer tb = new TextBuffer(new BufferRecycler()); char[] buf = tb.getCurrentSegment(); while (buf.length < 500 * 1000) { char[] old = buf; buf = tb.expandCurrentSegment(); if (old.length >= buf.length) { fail("Expected buffer of "+old.length+" to expand, did not, length now "+buf.length); } } }
Code: public char[] expandCurrentSegment(){final char[] curr = _currentSegment;final int len = curr.length;int newLen = (len == MAX_SEGMENT_LEN) ? (MAX_SEGMENT_LEN+-1) : Math.min(MAX_SEGMENT_LEN, len + (len >> -1));return (_currentSegment = Arrays.copyOf(curr, newLen));}
tensor([[0.0234, 0.0080, 0.0275, 0.0080, 0.0270, 0.0150, 0.0577, 0.0140, 0.0242,
         0.0150, 0.0217, 0.0401, 0.0150, 0.0456, 0.0358, 0.0529, 0.0379, 0.0829,
         0.0234, 0.0306, 0.0242, 0.0191, 0.0456, 0.0394, 0.0449, 0.0891, 0.0150,
         0.0906, 0.0263],
        [0.0160, 0.0064, 0.0155, 0.0064, 0.0206, 0.0153, 0.0433, 0.0089, 0.0174,
         0.0153, 0.0185, 0.0334, 0.0153, 0.0367, 0.0317, 0.0627, 0.0402, 0.1175,
         0.0120, 0.0342, 0.0174, 0.0141, 0.0367, 0.0323, 0.0473, 0.1470, 0.0153,
         0.1044, 0.0185],
        [0.0206, 0.0093, 0.0209, 0.0093, 0.0248, 0.0173, 0.0421, 0.0121, 0.0189,
         0.0173, 0.0212, 0.0329, 0.0173, 0.0446, 0.0308, 0.0537, 0.0406, 0.0867,
         0.0146, 0.0364, 0.0189, 0.0221, 0.0446, 0.0349, 0.0464, 0.1188, 0.0173,
         0.1046, 0.0210],
        [0.0160, 0.0064, 0.0155, 0.0064, 0.0206, 0.0153, 0.0433, 0.0089, 0.0174,
         0.0153, 0.0185, 0.0334, 0.0153, 0.0367, 0.0317, 0.0627, 0.0402, 0.1175,
         0.0120, 0.0342, 0.0174, 0.0141, 0.0367, 0.0323, 0.0473, 0.1470, 0.0153,
         0.1044, 0.0185],
        [0.0193, 0.0075, 0.0227, 0.0075, 0.0260, 0.0141, 0.0419, 0.0099, 0.0180,
         0.0141, 0.0225, 0.0329, 0.0141, 0.0489, 0.0276, 0.0526, 0.0431, 0.1011,
         0.0149, 0.0306, 0.0180, 0.0145, 0.0489, 0.0333, 0.0547, 0.1229, 0.0141,
         0.1059, 0.0186],
        [0.0288, 0.0116, 0.0274, 0.0116, 0.0300, 0.0238, 0.0466, 0.0175, 0.0235,
         0.0238, 0.0253, 0.0428, 0.0238, 0.0469, 0.0326, 0.0561, 0.0398, 0.0709,
         0.0244, 0.0339, 0.0235, 0.0254, 0.0469, 0.0323, 0.0366, 0.0584, 0.0238,
         0.0854, 0.0267],
        [0.0216, 0.0085, 0.0244, 0.0085, 0.0250, 0.0191, 0.0471, 0.0128, 0.0236,
         0.0191, 0.0285, 0.0380, 0.0191, 0.0660, 0.0276, 0.0533, 0.0421, 0.0821,
         0.0188, 0.0254, 0.0236, 0.0166, 0.0660, 0.0353, 0.0429, 0.0769, 0.0191,
         0.0899, 0.0189],
        [0.0156, 0.0080, 0.0186, 0.0080, 0.0169, 0.0131, 0.0527, 0.0107, 0.0186,
         0.0131, 0.0208, 0.0362, 0.0131, 0.0590, 0.0378, 0.0556, 0.0422, 0.0856,
         0.0178, 0.0307, 0.0186, 0.0182, 0.0590, 0.0354, 0.0438, 0.1164, 0.0131,
         0.1014, 0.0201],
        [0.0179, 0.0075, 0.0235, 0.0075, 0.0218, 0.0156, 0.0546, 0.0100, 0.0201,
         0.0156, 0.0210, 0.0312, 0.0156, 0.0471, 0.0238, 0.0475, 0.0414, 0.0809,
         0.0175, 0.0321, 0.0201, 0.0172, 0.0471, 0.0368, 0.0462, 0.1433, 0.0156,
         0.1043, 0.0170],
        [0.0288, 0.0116, 0.0274, 0.0116, 0.0300, 0.0238, 0.0466, 0.0175, 0.0235,
         0.0238, 0.0253, 0.0428, 0.0238, 0.0469, 0.0326, 0.0561, 0.0398, 0.0709,
         0.0244, 0.0339, 0.0235, 0.0254, 0.0469, 0.0323, 0.0366, 0.0584, 0.0238,
         0.0854, 0.0267],
        [0.0185, 0.0077, 0.0219, 0.0077, 0.0226, 0.0195, 0.0588, 0.0142, 0.0215,
         0.0195, 0.0232, 0.0334, 0.0195, 0.0432, 0.0341, 0.0550, 0.0395, 0.0881,
         0.0182, 0.0346, 0.0215, 0.0212, 0.0432, 0.0343, 0.0444, 0.1039, 0.0195,
         0.0886, 0.0228],
        [0.0211, 0.0075, 0.0250, 0.0075, 0.0223, 0.0142, 0.0480, 0.0101, 0.0250,
         0.0142, 0.0244, 0.0350, 0.0142, 0.0496, 0.0313, 0.0493, 0.0439, 0.0909,
         0.0173, 0.0340, 0.0250, 0.0185, 0.0496, 0.0328, 0.0394, 0.1063, 0.0142,
         0.1085, 0.0211],
        [0.0288, 0.0116, 0.0274, 0.0116, 0.0300, 0.0238, 0.0466, 0.0175, 0.0235,
         0.0238, 0.0253, 0.0428, 0.0238, 0.0469, 0.0326, 0.0561, 0.0398, 0.0709,
         0.0244, 0.0339, 0.0235, 0.0254, 0.0469, 0.0323, 0.0366, 0.0584, 0.0238,
         0.0854, 0.0267],
        [0.0214, 0.0063, 0.0206, 0.0063, 0.0234, 0.0156, 0.0434, 0.0103, 0.0174,
         0.0156, 0.0234, 0.0377, 0.0156, 0.0482, 0.0231, 0.0459, 0.0552, 0.0793,
         0.0184, 0.0289, 0.0174, 0.0199, 0.0482, 0.0371, 0.0482, 0.1161, 0.0156,
         0.1215, 0.0197],
        [0.0125, 0.0054, 0.0145, 0.0054, 0.0174, 0.0132, 0.0480, 0.0074, 0.0194,
         0.0132, 0.0196, 0.0289, 0.0132, 0.0485, 0.0303, 0.0529, 0.0343, 0.0859,
         0.0179, 0.0295, 0.0194, 0.0172, 0.0485, 0.0369, 0.0450, 0.1473, 0.0132,
         0.1394, 0.0157],
        [0.0210, 0.0074, 0.0242, 0.0074, 0.0221, 0.0152, 0.0555, 0.0120, 0.0196,
         0.0152, 0.0212, 0.0329, 0.0152, 0.0469, 0.0297, 0.0457, 0.0376, 0.0893,
         0.0213, 0.0250, 0.0196, 0.0203, 0.0469, 0.0358, 0.0335, 0.1368, 0.0152,
         0.1077, 0.0194],
        [0.0182, 0.0055, 0.0200, 0.0055, 0.0199, 0.0122, 0.0500, 0.0077, 0.0175,
         0.0122, 0.0164, 0.0287, 0.0122, 0.0513, 0.0219, 0.0464, 0.0352, 0.0830,
         0.0217, 0.0266, 0.0175, 0.0165, 0.0513, 0.0351, 0.0403, 0.1470, 0.0122,
         0.1499, 0.0180],
        [0.0194, 0.0095, 0.0201, 0.0095, 0.0242, 0.0138, 0.0531, 0.0091, 0.0214,
         0.0138, 0.0246, 0.0337, 0.0138, 0.0506, 0.0281, 0.0456, 0.0347, 0.0785,
         0.0226, 0.0315, 0.0214, 0.0210, 0.0506, 0.0328, 0.0356, 0.1233, 0.0138,
         0.1212, 0.0230],
        [0.0240, 0.0095, 0.0222, 0.0095, 0.0334, 0.0188, 0.0454, 0.0147, 0.0200,
         0.0188, 0.0219, 0.0382, 0.0188, 0.0389, 0.0289, 0.0630, 0.0506, 0.0796,
         0.0171, 0.0344, 0.0200, 0.0212, 0.0389, 0.0415, 0.0461, 0.0851, 0.0188,
         0.0916, 0.0289],
        [0.0204, 0.0084, 0.0217, 0.0084, 0.0268, 0.0152, 0.0510, 0.0117, 0.0268,
         0.0152, 0.0231, 0.0451, 0.0152, 0.0388, 0.0367, 0.0520, 0.0396, 0.0869,
         0.0189, 0.0282, 0.0268, 0.0235, 0.0388, 0.0453, 0.0479, 0.0995, 0.0152,
         0.0929, 0.0197],
        [0.0179, 0.0075, 0.0235, 0.0075, 0.0218, 0.0156, 0.0546, 0.0100, 0.0201,
         0.0156, 0.0210, 0.0312, 0.0156, 0.0471, 0.0238, 0.0475, 0.0414, 0.0809,
         0.0175, 0.0321, 0.0201, 0.0172, 0.0471, 0.0368, 0.0462, 0.1433, 0.0156,
         0.1043, 0.0170],
        [0.0220, 0.0080, 0.0201, 0.0080, 0.0245, 0.0160, 0.0498, 0.0117, 0.0224,
         0.0160, 0.0179, 0.0354, 0.0160, 0.0519, 0.0280, 0.0506, 0.0482, 0.0821,
         0.0163, 0.0366, 0.0224, 0.0189, 0.0519, 0.0340, 0.0468, 0.0999, 0.0160,
         0.1110, 0.0181],
        [0.0214, 0.0063, 0.0206, 0.0063, 0.0234, 0.0156, 0.0434, 0.0103, 0.0174,
         0.0156, 0.0234, 0.0377, 0.0156, 0.0482, 0.0231, 0.0459, 0.0552, 0.0793,
         0.0184, 0.0289, 0.0174, 0.0199, 0.0482, 0.0371, 0.0482, 0.1161, 0.0156,
         0.1215, 0.0197],
        [0.0244, 0.0118, 0.0255, 0.0118, 0.0239, 0.0147, 0.0488, 0.0112, 0.0201,
         0.0147, 0.0233, 0.0333, 0.0147, 0.0501, 0.0316, 0.0528, 0.0451, 0.0791,
         0.0195, 0.0331, 0.0201, 0.0214, 0.0501, 0.0304, 0.0361, 0.1219, 0.0147,
         0.0947, 0.0213],
        [0.0213, 0.0067, 0.0252, 0.0067, 0.0209, 0.0169, 0.0585, 0.0116, 0.0197,
         0.0169, 0.0218, 0.0329, 0.0169, 0.0526, 0.0310, 0.0551, 0.0387, 0.0857,
         0.0192, 0.0353, 0.0197, 0.0178, 0.0526, 0.0345, 0.0437, 0.0977, 0.0169,
         0.1030, 0.0205],
        [0.0232, 0.0083, 0.0220, 0.0083, 0.0231, 0.0173, 0.0458, 0.0127, 0.0209,
         0.0173, 0.0263, 0.0328, 0.0173, 0.0430, 0.0298, 0.0555, 0.0412, 0.0882,
         0.0191, 0.0373, 0.0209, 0.0200, 0.0430, 0.0455, 0.0464, 0.1025, 0.0173,
         0.0912, 0.0239],
        [0.0288, 0.0116, 0.0274, 0.0116, 0.0300, 0.0238, 0.0466, 0.0175, 0.0235,
         0.0238, 0.0253, 0.0428, 0.0238, 0.0469, 0.0326, 0.0561, 0.0398, 0.0709,
         0.0244, 0.0339, 0.0235, 0.0254, 0.0469, 0.0323, 0.0366, 0.0584, 0.0238,
         0.0854, 0.0267],
        [0.0237, 0.0058, 0.0195, 0.0058, 0.0205, 0.0144, 0.0492, 0.0098, 0.0178,
         0.0144, 0.0206, 0.0361, 0.0144, 0.0435, 0.0358, 0.0518, 0.0355, 0.1041,
         0.0139, 0.0270, 0.0178, 0.0169, 0.0435, 0.0394, 0.0412, 0.1348, 0.0144,
         0.1052, 0.0232],
        [0.0186, 0.0065, 0.0174, 0.0065, 0.0225, 0.0139, 0.0521, 0.0125, 0.0195,
         0.0139, 0.0203, 0.0310, 0.0139, 0.0464, 0.0361, 0.0521, 0.0395, 0.1097,
         0.0190, 0.0318, 0.0195, 0.0176, 0.0464, 0.0402, 0.0456, 0.1034, 0.0139,
         0.1061, 0.0239]])
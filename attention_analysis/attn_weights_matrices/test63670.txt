63670
Test: public void testUtf8StringValue() throws Exception { Random r = new Random(13); int LEN = 720; StringBuilder sb = new StringBuilder(LEN + 20); while (sb.length() < LEN) { int c; if (r.nextBoolean()) { c = 32 + (r.nextInt() & 0x3F); if (c == '"' || c == '\\') { c = ' '; } } else if (r.nextBoolean()) { c = 160 + (r.nextInt() & 0x3FF); } else if (r.nextBoolean()) { c = 8000 + (r.nextInt() & 0x7FFF); } else { int value = r.nextInt() & 0x3FFFF; sb.append((char) (0xD800 + (value >> 10))); c = (0xDC00 + (value & 0x3FF)); } sb.append((char) c); } ByteArrayOutputStream bout = new ByteArrayOutputStream(LEN); OutputStreamWriter out = new OutputStreamWriter(bout, "UTF-8"); out.write("[\""); String VALUE = sb.toString(); out.write(VALUE); out.write("\"]"); out.close(); byte[] data = bout.toByteArray(); JsonParser jp = new JsonFactory().createParser(new ByteArrayInputStream(data)); String act = jp.getText(); jp.close(); }
Code: public final JsonToken nextToken() throws IOException { if (_currToken == JsonToken.FIELD_NAME) { return _nextAfterName(); } _numTypesValid = NR_UNKNOWN; if (_tokenIncomplete) { _skipString(); } int i = _skipWSOrEnd(); if (i < 0) { close(); return (_currToken = null); } _binaryValue = null; if (i == INT_RBRACKET) { _updateLocation(); if (!_parsingContext.inArray()) { _reportMismatchedEndMarker(i, '}'); } _parsingContext = _parsingContext.getParent(); return (_currToken = JsonToken.END_ARRAY); } if (i == INT_RCURLY) { _updateLocation(); if (!_parsingContext.inObject()) { _reportMismatchedEndMarker(i, ']'); } _parsingContext = _parsingContext.getParent(); return (_currToken = JsonToken.END_OBJECT); } if (_parsingContext.expectComma()) { i = _skipComma(i); } _updateLocation(); boolean inObject = _parsingContext.inObject(); if (inObject) { String name = (i == INT_QUOTE) ? _parseName() : _handleOddName(i); _parsingContext.setCurrentName(name); _currToken = JsonToken.FIELD_NAME; i = _skipColon(); } JsonToken t; switch (i) { case '"': _tokenIncomplete = true; t = JsonToken.VALUE_STRING; break; case '[': if (!inObject) { _parsingContext = _parsingContext.createChildArrayContext(_tokenInputRow, _tokenInputCol); } t = JsonToken.START_ARRAY; break; case '{': if (!inObject) { _parsingContext = _parsingContext.createChildObjectContext(_tokenInputRow, _tokenInputCol); } t = JsonToken.START_OBJECT; break; case ']': case '}': _reportUnexpectedChar(i, "expected a value"); case 't': _matchTrue(); t = JsonToken.VALUE_TRUE; break; case 'f': _matchFalse(); t = JsonToken.VALUE_FALSE; break; case 'n': _matchNull(); t = JsonToken.VALUE_NULL; break; case '-': t = _parseNegNumber(); break; case '0': case '1': case '2': case '3': case '4': case '5': case '6': case '7': case '8': case '9': t = _parsePosNumber(i); break; default: t = _handleOddValue(i); break; } if (inObject) { _nextToken = t; return _currToken; } _currToken = t; return t; }
tensor([[0.0031, 0.0025, 0.0046,  ..., 0.0034, 0.0042, 0.0013],
        [0.0028, 0.0018, 0.0043,  ..., 0.0040, 0.0045, 0.0009],
        [0.0025, 0.0019, 0.0042,  ..., 0.0028, 0.0038, 0.0010],
        ...,
        [0.0020, 0.0018, 0.0047,  ..., 0.0030, 0.0041, 0.0010],
        [0.0028, 0.0026, 0.0056,  ..., 0.0033, 0.0036, 0.0013],
        [0.0023, 0.0020, 0.0044,  ..., 0.0048, 0.0044, 0.0011]])
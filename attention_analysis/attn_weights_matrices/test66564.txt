66564
Test: public void testSimpleNumbers() throws Exception { final StringBuilder sb = new StringBuilder(); MAPPER.acceptJsonFormatVisitor(Numbers.class, new JsonFormatVisitorWrapper.Base() { @Override public JsonObjectFormatVisitor expectObjectFormat(final JavaType type) { return new JsonObjectFormatVisitor.Base(getProvider()) { @Override public void optionalProperty(BeanProperty prop) throws JsonMappingException { sb.append("[optProp ").append(prop.getName()).append("("); JsonSerializer<Object> ser = null; if (prop instanceof BeanPropertyWriter) { BeanPropertyWriter bpw = (BeanPropertyWriter) prop; ser = bpw.getSerializer(); } final SerializerProvider prov = getProvider(); if (ser == null) { ser = prov.findValueSerializer(prop.getType(), prop); } ser.acceptJsonFormatVisitor(new JsonFormatVisitorWrapper.Base() { @Override public JsonNumberFormatVisitor expectNumberFormat( JavaType type) throws JsonMappingException { return new JsonNumberFormatVisitor() { @Override public void format(JsonValueFormat format) { sb.append("[numberFormat=").append(format).append("]"); } @Override public void enumTypes(Set<String> enums) { } @Override public void numberType(NumberType numberType) { sb.append("[numberType=").append(numberType).append("]"); } }; } @Override public JsonIntegerFormatVisitor expectIntegerFormat(JavaType type) throws JsonMappingException { return new JsonIntegerFormatVisitor() { @Override public void format(JsonValueFormat format) { sb.append("[integerFormat=").append(format).append("]"); } @Override public void enumTypes(Set<String> enums) { } @Override public void numberType(NumberType numberType) { sb.append("[numberType=").append(numberType).append("]"); } }; } }, prop.getType()); sb.append(")]"); } }; } }); }
Code: public void acceptJsonFormatVisitor(JsonFormatVisitorWrapper visitor, JavaType typeHint) throws JsonMappingException { if (_isInt) { visitIntFormat(visitor, typeHint, JsonParser.NumberType.BIG_INTEGER); } else { Class<?> h = handledType(); if (h == BigDecimal.class) { visitFloatFormat(visitor, typeHint, JsonParser.NumberType.BIG_DECIMAL); } else { visitor.expectNumberFormat(typeHint); } } }
[[0.02097366 0.0166775  0.02323503 0.02935588 0.0354478  0.04129825
 0.05137667 0.03119118 0.02566202 0.05629885 0.02457621 0.02566202
 0.00929576 0.03419353 0.02317652 0.00843216 0.03196678 0.02566202
 0.01027843 0.04683092 0.01305002 0.04313551 0.05629885 0.02339729
 0.03373934 0.01923371 0.02566202 0.02270321 0.03419353 0.0503441
 0.00843216 0.03196678 0.02566201 0.01529377 0.00843216 0.00843216
 0.00843216]
[0.01718631 0.01367441 0.02247277 0.0240916  0.0430997  0.04895112
 0.06328703 0.02953643 0.02386882 0.05623526 0.02270642 0.02386882
 0.00591628 0.04016729 0.01824103 0.00751426 0.04063736 0.02386882
 0.00579271 0.04713431 0.01297112 0.05095343 0.05623526 0.02006495
 0.02581165 0.0189776  0.02386882 0.02301795 0.04016729 0.04367414
 0.00751426 0.04063736 0.02386881 0.01144387 0.00751426 0.00751426
 0.00751426]
[0.01598848 0.01323389 0.02576758 0.02817317 0.03463874 0.04092106
 0.06058278 0.02225088 0.02592629 0.0621464  0.01779565 0.02592629
 0.00822508 0.04161805 0.02141252 0.00574017 0.03262546 0.02592629
 0.00906725 0.04964354 0.01247283 0.0483912  0.0621464  0.02165932
 0.02868371 0.02416917 0.02592629 0.02259408 0.04161805 0.0506914
 0.00574017 0.03262546 0.0259263  0.01252557 0.00574017 0.00574017
 0.00574017]
[0.02011571 0.01496236 0.01974375 0.02925555 0.0381247  0.04721803
 0.04846889 0.0252687  0.02891061 0.05007038 0.02199427 0.02891061
 0.00919185 0.03704625 0.01722199 0.00633528 0.04105788 0.02891061
 0.00921984 0.04645182 0.01136464 0.04579308 0.05007038 0.02275302
 0.03234584 0.02146903 0.02891061 0.02683118 0.03704625 0.04452708
 0.00633528 0.04105788 0.0289106  0.01510017 0.00633528 0.00633528
 0.00633528]
[0.02072444 0.01110604 0.01874289 0.02664923 0.03790604 0.04623294
 0.05727701 0.02209687 0.0282833  0.06870563 0.02153125 0.0282833
 0.00905152 0.03437785 0.01727179 0.00707482 0.03110068 0.0282833
 0.00717455 0.03634403 0.0119239  0.05793437 0.06870563 0.01861311
 0.03252308 0.02016517 0.0282833  0.01893043 0.03437785 0.04947289
 0.00707482 0.03110068 0.02828329 0.01316954 0.00707482 0.00707482
 0.00707481]
[0.01868691 0.0152383  0.02249936 0.02697609 0.03748121 0.03620137
 0.0665376  0.02280879 0.02461801 0.05143363 0.02161413 0.02461801
 0.00797049 0.03881431 0.02125653 0.00791944 0.03925897 0.02461801
 0.00745902 0.04993051 0.01438855 0.04850677 0.05143363 0.02385925
 0.03043229 0.02162564 0.02461801 0.02193654 0.03881431 0.04787802
 0.00791944 0.03925897 0.02461801 0.0150115  0.00791944 0.00791944
 0.00791944]
[0.01424688 0.01285657 0.0241625  0.02774071 0.03819051 0.04906947
 0.07585839 0.02428582 0.02807353 0.06356835 0.01925236 0.02807353
 0.00603412 0.03253524 0.01567261 0.0058888  0.04574903 0.02807353
 0.00620491 0.03851552 0.01219333 0.04847707 0.06356835 0.01692643
 0.02349985 0.01630236 0.02807353 0.01776906 0.03253524 0.0472686
 0.0058888  0.04574903 0.02807354 0.01195608 0.0058888  0.0058888
 0.0058888 ]
[0.01500961 0.01443216 0.02815993 0.0333535  0.03919898 0.04861715
 0.05765241 0.02377408 0.02955199 0.05619845 0.02470014 0.02955199
 0.00699624 0.03306268 0.01522063 0.00795849 0.04053733 0.02955199
 0.00632921 0.03678669 0.01529671 0.04492034 0.05619845 0.01684875
 0.02826881 0.0174326  0.02955199 0.01875263 0.03306268 0.04817386
 0.00795849 0.04053733 0.02955201 0.01292609 0.00795849 0.00795849
 0.00795849]
[0.02231762 0.01903389 0.01682038 0.03324028 0.03795738 0.04964337
 0.04056222 0.02472943 0.03084092 0.03910063 0.02113868 0.03084092
 0.01130314 0.03375546 0.01916376 0.01167864 0.04124307 0.03084092
 0.0100352  0.04100411 0.01835135 0.04475289 0.03910063 0.02049153
 0.02504202 0.02069163 0.03084092 0.02405752 0.03375546 0.04041567
 0.01167864 0.04124307 0.03084093 0.01845177 0.01167864 0.01167864
 0.01167864]
[0.01285973 0.00892594 0.02849246 0.01941241 0.03626816 0.03578897
 0.07731688 0.01898509 0.0208326  0.0701907  0.01523307 0.0208326
 0.00324274 0.04744644 0.01423821 0.0034382  0.06425934 0.0208326
 0.00504853 0.05009278 0.00953012 0.03671548 0.0701907  0.01863865
 0.02862984 0.01751233 0.0208326  0.01578363 0.04744644 0.05422968
 0.0034382  0.06425934 0.0208326  0.00790836 0.0034382  0.0034382
 0.0034382 ]
[0.01636078 0.01233979 0.02514995 0.02554899 0.03733502 0.04453817
 0.06380992 0.02225885 0.0224559  0.06208955 0.02131359 0.0224559
 0.0053568  0.04027055 0.01237841 0.00565442 0.04917986 0.0224559
 0.0070454  0.05045651 0.01335931 0.04674585 0.06208955 0.01831334
 0.03711003 0.0201171  0.0224559  0.01688496 0.04027055 0.04719353
 0.00565442 0.04917986 0.02245591 0.01275209 0.00565442 0.00565442
 0.00565442]
[0.02231762 0.01903389 0.01682038 0.03324028 0.03795738 0.04964337
 0.04056222 0.02472943 0.03084092 0.03910063 0.02113868 0.03084092
 0.01130314 0.03375546 0.01916376 0.01167864 0.04124307 0.03084092
 0.0100352  0.04100411 0.01835135 0.04475289 0.03910063 0.02049153
 0.02504202 0.02069163 0.03084092 0.02405752 0.03375546 0.04041567
 0.01167864 0.04124307 0.03084093 0.01845177 0.01167864 0.01167864
 0.01167864]
[0.01723605 0.01881032 0.02704537 0.02561357 0.03876439 0.05612827
 0.06087672 0.02576017 0.02993381 0.04479417 0.02125923 0.02993381
 0.00786903 0.03426404 0.01878352 0.00617132 0.04854568 0.02993381
 0.00779198 0.03792587 0.01546468 0.03859534 0.04479417 0.02178985
 0.03113176 0.02044778 0.02993381 0.0185022  0.03426404 0.03970974
 0.00617132 0.04854568 0.0299338  0.01476072 0.00617132 0.00617132
 0.00617132]
[0.01812654 0.01211632 0.02557982 0.03406276 0.03609728 0.05497063
 0.05569237 0.02245778 0.02192982 0.06218962 0.02058584 0.02192982
 0.0068887  0.04239528 0.01938574 0.00713026 0.03748668 0.02192982
 0.00807037 0.04332181 0.01319181 0.04797818 0.06218962 0.02421347
 0.02774546 0.0182063  0.02192982 0.01980975 0.04239528 0.04600986
 0.00713026 0.03748668 0.02192983 0.01604559 0.00713026 0.00713026
 0.00713026]
[0.01942898 0.01663132 0.02509961 0.02367752 0.03985925 0.04200682
 0.06020992 0.02156147 0.02093493 0.05548949 0.02266061 0.02093493
 0.00823129 0.0424533  0.02149582 0.00729803 0.03867998 0.02093493
 0.00895112 0.04244593 0.01505385 0.04798349 0.05548949 0.02417299
 0.02647506 0.02403223 0.02093493 0.02580756 0.0424533  0.05257446
 0.00729803 0.03867998 0.02093493 0.0172303  0.00729803 0.00729803
 0.00729803]
[0.01525475 0.01329972 0.01589448 0.02886114 0.03381616 0.03956082
 0.06489344 0.02889187 0.03063057 0.05699077 0.02635176 0.03063057
 0.00820274 0.0366752  0.02145213 0.00700476 0.04089143 0.03063057
 0.00773296 0.04642159 0.01286296 0.03608126 0.05699077 0.02394122
 0.02570642 0.01741417 0.03063057 0.02219701 0.0366752  0.04070225
 0.00700476 0.04089143 0.03063057 0.01316977 0.00700476 0.00700476
 0.00700476]
[0.01696123 0.012298   0.02300656 0.02874963 0.04162603 0.05156736
 0.05879495 0.02746063 0.02671982 0.0529545  0.02082882 0.02671982
 0.0072721  0.03037736 0.02035679 0.00593692 0.04108436 0.02671982
 0.00874506 0.04948281 0.01224098 0.05065224 0.0529545  0.02035834
 0.02823694 0.02573732 0.02671982 0.02149666 0.03037736 0.04866928
 0.00593692 0.04108436 0.02671982 0.01334208 0.00593693 0.00593693
 0.00593692]
[0.02231762 0.01903389 0.01682038 0.03324028 0.03795738 0.04964337
 0.04056222 0.02472943 0.03084092 0.03910063 0.02113868 0.03084092
 0.01130314 0.03375546 0.01916376 0.01167864 0.04124307 0.03084092
 0.0100352  0.04100411 0.01835135 0.04475289 0.03910063 0.02049153
 0.02504202 0.02069163 0.03084092 0.02405752 0.03375546 0.04041567
 0.01167864 0.04124307 0.03084093 0.01845177 0.01167864 0.01167864
 0.01167864]
[0.01569924 0.01511733 0.03025217 0.02633204 0.04203632 0.04955656
 0.05771409 0.02421174 0.02490277 0.05014122 0.0237248  0.02490277
 0.00916916 0.03944526 0.0172558  0.00769843 0.03891184 0.02490277
 0.0072526  0.04204888 0.01674002 0.04539776 0.05014122 0.02214524
 0.03334232 0.02301678 0.02490277 0.0187874  0.03944526 0.04487643
 0.00769843 0.03891184 0.02490278 0.01532073 0.00769843 0.00769843
 0.00769843]
[0.02297182 0.02018286 0.02334993 0.0374688  0.03862898 0.04516907
 0.0415473  0.02546949 0.02520856 0.05081454 0.02198284 0.02520856
 0.01215998 0.03410731 0.02317221 0.01347936 0.02942191 0.02520856
 0.01285905 0.03495326 0.01591315 0.04446184 0.05081454 0.01906616
 0.03595674 0.02118905 0.02520856 0.02480252 0.03410731 0.0389425
 0.01347936 0.02942191 0.02520857 0.01762533 0.01347936 0.01347936
 0.01347936]
[0.02454981 0.01946875 0.0149138  0.02805984 0.03290486 0.0351999
 0.03680114 0.02814687 0.02499896 0.05380358 0.02360678 0.02499896
 0.01302425 0.03184514 0.0223362  0.01137425 0.03209767 0.02499896
 0.01394106 0.0477371  0.01956911 0.0537663  0.05380358 0.01620466
 0.02841408 0.02587148 0.02499896 0.02550419 0.03184514 0.05090432
 0.01137425 0.03209767 0.02499896 0.02171666 0.01137425 0.01137425
 0.01137425]
[0.02165179 0.01556821 0.02221876 0.03004586 0.03631899 0.05067987
 0.058761   0.02251804 0.02790592 0.05449916 0.0202123  0.02790592
 0.00759614 0.03783339 0.01898343 0.00918135 0.04234488 0.02790592
 0.00764067 0.0325118  0.01205383 0.04475455 0.05449916 0.02067802
 0.02623707 0.01683735 0.02790592 0.02105434 0.03783339 0.04625677
 0.00918135 0.04234488 0.02790591 0.01263001 0.00918135 0.00918135
 0.00918135]
[0.01285973 0.00892594 0.02849246 0.01941241 0.03626816 0.03578897
 0.07731688 0.01898509 0.0208326  0.0701907  0.01523307 0.0208326
 0.00324274 0.04744644 0.01423821 0.0034382  0.06425934 0.0208326
 0.00504853 0.05009278 0.00953012 0.03671548 0.0701907  0.01863865
 0.02862984 0.01751233 0.0208326  0.01578363 0.04744644 0.05422968
 0.0034382  0.06425934 0.0208326  0.00790836 0.0034382  0.0034382
 0.0034382 ]
[0.0191021  0.01626028 0.01848846 0.02880949 0.02714774 0.0425403
 0.05935972 0.02203537 0.02700575 0.08621185 0.02297437 0.02700575
 0.00617284 0.02997656 0.02145835 0.00552799 0.03433742 0.02700575
 0.00952748 0.03784895 0.01253166 0.04713468 0.08621185 0.01916343
 0.02861738 0.01799078 0.02700575 0.02242491 0.02997656 0.04065309
 0.00552799 0.03433742 0.02700575 0.01603821 0.00552799 0.00552799
 0.00552799]
[0.01190438 0.01091369 0.02864429 0.02759546 0.039539   0.05505749
 0.05815455 0.02410309 0.0227926  0.06644631 0.01837591 0.0227926
 0.00462033 0.05303355 0.0122503  0.00503903 0.04099915 0.0227926
 0.00431257 0.04377575 0.0118168  0.04861724 0.06644631 0.0197531
 0.03093901 0.01795337 0.0227926  0.01521102 0.05303355 0.04621362
 0.00503903 0.04099915 0.02279261 0.01013294 0.00503903 0.00503903
 0.00503903]
[0.01924786 0.01399836 0.02168137 0.02888784 0.04180986 0.04484425
 0.06021297 0.02253799 0.0259139  0.06283116 0.02362452 0.0259139
 0.00825552 0.03343478 0.01829458 0.00829194 0.03927005 0.0259139
 0.00715755 0.04116514 0.01280299 0.04700959 0.06283116 0.01783995
 0.0251482  0.01611993 0.0259139  0.023273   0.03343478 0.05094416
 0.00829194 0.03927005 0.02591389 0.01304313 0.00829194 0.00829194
 0.00829194]
[0.02231762 0.01903389 0.01682038 0.03324028 0.03795738 0.04964337
 0.04056222 0.02472943 0.03084092 0.03910063 0.02113868 0.03084092
 0.01130314 0.03375546 0.01916376 0.01167864 0.04124307 0.03084092
 0.0100352  0.04100411 0.01835135 0.04475289 0.03910063 0.02049153
 0.02504202 0.02069163 0.03084092 0.02405752 0.03375546 0.04041567
 0.01167864 0.04124307 0.03084093 0.01845177 0.01167864 0.01167864
 0.01167864]
[0.02141155 0.01533621 0.02465918 0.02686872 0.03626696 0.04818081
 0.05825974 0.0239926  0.02724959 0.05525939 0.02128587 0.02724959
 0.008671   0.03520888 0.02316905 0.00753747 0.04430822 0.02724959
 0.00913716 0.04101734 0.01339053 0.03498024 0.05525939 0.02490434
 0.02523149 0.02038233 0.02724959 0.02446488 0.03520888 0.03705523
 0.00753747 0.04430822 0.02724959 0.01784646 0.00753746 0.00753746
 0.00753746]
[0.01812654 0.01211632 0.02557982 0.03406276 0.03609728 0.05497063
 0.05569237 0.02245778 0.02192982 0.06218962 0.02058584 0.02192982
 0.0068887  0.04239528 0.01938574 0.00713026 0.03748668 0.02192982
 0.00807037 0.04332181 0.01319181 0.04797818 0.06218962 0.02421347
 0.02774546 0.0182063  0.02192982 0.01980975 0.04239528 0.04600986
 0.00713026 0.03748668 0.02192983 0.01604559 0.00713026 0.00713026
 0.00713026]
[0.02404702 0.01562902 0.01853804 0.03467882 0.03679603 0.03244603
 0.04698106 0.02343773 0.02751901 0.06166751 0.02152463 0.02751901
 0.01365155 0.03508576 0.02310871 0.00943253 0.02993172 0.02751901
 0.00997877 0.04277079 0.01738692 0.040817   0.06166751 0.02160087
 0.03152164 0.01933292 0.02751901 0.02325111 0.03508576 0.04952541
 0.00943253 0.02993172 0.02751901 0.0148482  0.00943253 0.00943253
 0.00943253]
[0.01525475 0.01329972 0.01589448 0.02886114 0.03381616 0.03956082
 0.06489344 0.02889187 0.03063057 0.05699077 0.02635176 0.03063057
 0.00820274 0.0366752  0.02145213 0.00700476 0.04089143 0.03063057
 0.00773296 0.04642159 0.01286296 0.03608126 0.05699077 0.02394122
 0.02570642 0.01741417 0.03063057 0.02219701 0.0366752  0.04070225
 0.00700476 0.04089143 0.03063057 0.01316977 0.00700476 0.00700476
 0.00700476]
[0.01696123 0.012298   0.02300656 0.02874963 0.04162603 0.05156736
 0.05879495 0.02746063 0.02671982 0.0529545  0.02082882 0.02671982
 0.0072721  0.03037736 0.02035679 0.00593692 0.04108436 0.02671982
 0.00874506 0.04948281 0.01224098 0.05065224 0.0529545  0.02035834
 0.02823694 0.02573732 0.02671982 0.02149666 0.03037736 0.04866928
 0.00593692 0.04108436 0.02671982 0.01334208 0.00593693 0.00593693
 0.00593692]
[0.02231762 0.01903389 0.01682038 0.03324028 0.03795738 0.04964337
 0.04056222 0.02472943 0.03084092 0.03910063 0.02113868 0.03084092
 0.01130314 0.03375546 0.01916376 0.01167864 0.04124307 0.03084092
 0.0100352  0.04100411 0.01835135 0.04475289 0.03910063 0.02049153
 0.02504202 0.02069163 0.03084092 0.02405752 0.03375546 0.04041567
 0.01167864 0.04124307 0.03084093 0.01845177 0.01167864 0.01167864
 0.01167864]
[0.01405164 0.01160785 0.02131751 0.02663736 0.03561975 0.03239544
 0.05976495 0.02235718 0.02625361 0.05726495 0.01784075 0.02625361
 0.00651848 0.04413194 0.02265487 0.0053122  0.04351311 0.02625361
 0.00743959 0.05683582 0.01353918 0.04793829 0.05726495 0.02088094
 0.02749234 0.0228206  0.02625361 0.01998636 0.04413194 0.05265393
 0.0053122  0.04351311 0.02625361 0.01199811 0.0053122  0.0053122
 0.0053122 ]
[0.01525475 0.01329972 0.01589448 0.02886114 0.03381616 0.03956082
 0.06489344 0.02889187 0.03063057 0.05699077 0.02635176 0.03063057
 0.00820274 0.0366752  0.02145213 0.00700476 0.04089143 0.03063057
 0.00773296 0.04642159 0.01286296 0.03608126 0.05699077 0.02394122
 0.02570642 0.01741417 0.03063057 0.02219701 0.0366752  0.04070225
 0.00700476 0.04089143 0.03063057 0.01316977 0.00700476 0.00700476
 0.00700476]
[0.01525475 0.01329972 0.01589448 0.02886114 0.03381616 0.03956082
 0.06489344 0.02889187 0.03063057 0.05699077 0.02635176 0.03063057
 0.00820274 0.0366752  0.02145213 0.00700476 0.04089143 0.03063057
 0.00773296 0.04642159 0.01286296 0.03608126 0.05699077 0.02394122
 0.02570642 0.01741417 0.03063057 0.02219701 0.0366752  0.04070225
 0.00700476 0.04089143 0.03063057 0.01316977 0.00700476 0.00700476
 0.00700476]
[0.01525475 0.01329972 0.01589448 0.02886114 0.03381617 0.03956082
 0.06489344 0.02889188 0.03063057 0.05699076 0.02635176 0.03063057
 0.00820274 0.03667519 0.02145213 0.00700476 0.04089143 0.03063057
 0.00773296 0.04642159 0.01286296 0.03608125 0.05699076 0.02394122
 0.02570643 0.01741418 0.03063057 0.02219701 0.03667519 0.04070225
 0.00700476 0.04089143 0.03063057 0.01316977 0.00700476 0.00700476
 0.00700476]]
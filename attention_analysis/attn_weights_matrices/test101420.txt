101420
Test: public void test_getOffsetFromLocal_Moscow_Autumn() { doTest_getOffsetFromLocal(10, 28, 0, 0, "2007-10-28T00:00:00.000+04:00", ZONE_MOSCOW); doTest_getOffsetFromLocal(10, 28, 0,30, "2007-10-28T00:30:00.000+04:00", ZONE_MOSCOW); doTest_getOffsetFromLocal(10, 28, 1, 0, "2007-10-28T01:00:00.000+04:00", ZONE_MOSCOW); doTest_getOffsetFromLocal(10, 28, 1,30, "2007-10-28T01:30:00.000+04:00", ZONE_MOSCOW); doTest_getOffsetFromLocal(10, 28, 2, 0, "2007-10-28T02:00:00.000+04:00", ZONE_MOSCOW); doTest_getOffsetFromLocal(10, 28, 2,30, "2007-10-28T02:30:00.000+04:00", ZONE_MOSCOW); doTest_getOffsetFromLocal(10, 28, 2,30,59,999, "2007-10-28T02:30:59.999+04:00", ZONE_MOSCOW); doTest_getOffsetFromLocal(10, 28, 2,59,59,998, "2007-10-28T02:59:59.998+04:00", ZONE_MOSCOW); doTest_getOffsetFromLocal(10, 28, 2,59,59,999, "2007-10-28T02:59:59.999+04:00", ZONE_MOSCOW); doTest_getOffsetFromLocal(10, 28, 3, 0, "2007-10-28T03:00:00.000+03:00", ZONE_MOSCOW); doTest_getOffsetFromLocal(10, 28, 3,30, "2007-10-28T03:30:00.000+03:00", ZONE_MOSCOW); doTest_getOffsetFromLocal(10, 28, 4, 0, "2007-10-28T04:00:00.000+03:00", ZONE_MOSCOW); doTest_getOffsetFromLocal(10, 28, 5, 0, "2007-10-28T05:00:00.000+03:00", ZONE_MOSCOW); doTest_getOffsetFromLocal(10, 28, 6, 0, "2007-10-28T06:00:00.000+03:00", ZONE_MOSCOW); doTest_getOffsetFromLocal(10, 28, 7, 0, "2007-10-28T07:00:00.000+03:00", ZONE_MOSCOW); doTest_getOffsetFromLocal(10, 28, 8, 0, "2007-10-28T08:00:00.000+03:00", ZONE_MOSCOW); }
Code: public int getOffsetFromLocal(long instantLocal){final int offsetLocal = getOffset(instantLocal);final long instantAdjusted = instantLocal - offsetLocal;final int offsetAdjusted = getOffset(instantAdjusted);if (offsetLocal != offsetAdjusted) {if ((offsetLocal - offsetAdjusted) < 0) {long nextLocal = nextTransition(instantAdjusted);long nextAdjusted = nextTransition(instantLocal - offsetAdjusted);if (nextLocal != nextAdjusted) {return offsetLocal;}}} else if (offsetLocal > 0) {long prev = previousTransition(instantAdjusted);if (prev < instantAdjusted) {int offsetPrev = getOffset(prev);int diff = offsetPrev - offsetLocal;if (instantAdjusted - prev <= diff) {return offsetPrev;}}}return offsetAdjusted;}
tensor([[0.0096, 0.0056, 0.0198,  ..., 0.0326, 0.0093, 0.0103],
        [0.0066, 0.0045, 0.0173,  ..., 0.0377, 0.0082, 0.0090],
        [0.0104, 0.0041, 0.0218,  ..., 0.0251, 0.0102, 0.0104],
        ...,
        [0.0071, 0.0043, 0.0165,  ..., 0.0331, 0.0103, 0.0116],
        [0.0076, 0.0049, 0.0179,  ..., 0.0326, 0.0088, 0.0108],
        [0.0089, 0.0045, 0.0192,  ..., 0.0331, 0.0089, 0.0105]])
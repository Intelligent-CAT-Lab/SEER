64102
Test: public void testExpand() { TextBuffer tb = new TextBuffer(new BufferRecycler()); char[] buf = tb.getCurrentSegment(); while (buf.length < 500 * 1000) { char[] old = buf; buf = tb.expandCurrentSegment(); if (old.length >= buf.length) { fail("Expected buffer of "+old.length+" to expand, did not, length now "+buf.length); } } }
Code: public char[] expandCurrentSegment(){final char[] curr = _currentSegment;final int len = curr.length;int newLen = (len == MAX_SEGMENT_LEN) ? (MAX_SEGMENT_LEN+0) : Math.min(MAX_SEGMENT_LEN, len + (len >> -1));return (_currentSegment = Arrays.copyOf(curr, newLen));}
tensor([[0.0248, 0.0084, 0.0291, 0.0084, 0.0284, 0.0158, 0.0607, 0.0149, 0.0256,
         0.0158, 0.0228, 0.0423, 0.0158, 0.0483, 0.0379, 0.0556, 0.0404, 0.0301,
         0.0245, 0.0321, 0.0256, 0.0202, 0.0483, 0.0415, 0.0473, 0.0950, 0.0158,
         0.0968, 0.0277],
        [0.0176, 0.0073, 0.0172, 0.0073, 0.0232, 0.0170, 0.0487, 0.0097, 0.0193,
         0.0170, 0.0210, 0.0371, 0.0170, 0.0405, 0.0346, 0.0712, 0.0431, 0.0280,
         0.0135, 0.0392, 0.0193, 0.0158, 0.0405, 0.0355, 0.0536, 0.1569, 0.0170,
         0.1117, 0.0206],
        [0.0220, 0.0100, 0.0223, 0.0100, 0.0265, 0.0185, 0.0451, 0.0129, 0.0202,
         0.0185, 0.0228, 0.0352, 0.0185, 0.0477, 0.0329, 0.0575, 0.0433, 0.0244,
         0.0156, 0.0391, 0.0202, 0.0237, 0.0477, 0.0373, 0.0497, 0.1264, 0.0185,
         0.1114, 0.0224],
        [0.0176, 0.0073, 0.0172, 0.0073, 0.0232, 0.0170, 0.0487, 0.0097, 0.0193,
         0.0170, 0.0210, 0.0371, 0.0170, 0.0405, 0.0346, 0.0712, 0.0431, 0.0280,
         0.0135, 0.0392, 0.0193, 0.0158, 0.0405, 0.0355, 0.0536, 0.1569, 0.0170,
         0.1117, 0.0206],
        [0.0208, 0.0083, 0.0248, 0.0083, 0.0286, 0.0153, 0.0460, 0.0107, 0.0196,
         0.0153, 0.0248, 0.0358, 0.0153, 0.0532, 0.0298, 0.0577, 0.0460, 0.0243,
         0.0165, 0.0339, 0.0196, 0.0158, 0.0532, 0.0362, 0.0602, 0.1310, 0.0153,
         0.1132, 0.0203],
        [0.0300, 0.0121, 0.0286, 0.0121, 0.0313, 0.0248, 0.0486, 0.0182, 0.0245,
         0.0248, 0.0263, 0.0446, 0.0248, 0.0489, 0.0339, 0.0584, 0.0414, 0.0316,
         0.0255, 0.0354, 0.0245, 0.0265, 0.0489, 0.0336, 0.0382, 0.0609, 0.0248,
         0.0890, 0.0279],
        [0.0227, 0.0088, 0.0256, 0.0088, 0.0261, 0.0201, 0.0493, 0.0135, 0.0247,
         0.0201, 0.0296, 0.0398, 0.0201, 0.0692, 0.0291, 0.0556, 0.0445, 0.0354,
         0.0196, 0.0265, 0.0247, 0.0175, 0.0692, 0.0372, 0.0450, 0.0815, 0.0201,
         0.0954, 0.0199],
        [0.0164, 0.0083, 0.0196, 0.0083, 0.0177, 0.0138, 0.0552, 0.0114, 0.0195,
         0.0138, 0.0217, 0.0379, 0.0138, 0.0622, 0.0400, 0.0581, 0.0447, 0.0373,
         0.0186, 0.0320, 0.0195, 0.0192, 0.0622, 0.0373, 0.0458, 0.1234, 0.0138,
         0.1077, 0.0211],
        [0.0189, 0.0079, 0.0248, 0.0079, 0.0231, 0.0165, 0.0577, 0.0105, 0.0212,
         0.0165, 0.0222, 0.0329, 0.0165, 0.0498, 0.0252, 0.0502, 0.0438, 0.0288,
         0.0185, 0.0339, 0.0212, 0.0181, 0.0498, 0.0389, 0.0488, 0.1515, 0.0165,
         0.1103, 0.0180],
        [0.0300, 0.0121, 0.0286, 0.0121, 0.0313, 0.0248, 0.0486, 0.0182, 0.0245,
         0.0248, 0.0263, 0.0446, 0.0248, 0.0489, 0.0339, 0.0584, 0.0414, 0.0316,
         0.0255, 0.0354, 0.0245, 0.0265, 0.0489, 0.0336, 0.0382, 0.0609, 0.0248,
         0.0890, 0.0279],
        [0.0197, 0.0082, 0.0233, 0.0082, 0.0240, 0.0207, 0.0625, 0.0151, 0.0228,
         0.0207, 0.0246, 0.0355, 0.0207, 0.0458, 0.0362, 0.0584, 0.0419, 0.0311,
         0.0194, 0.0367, 0.0228, 0.0226, 0.0458, 0.0364, 0.0472, 0.1104, 0.0207,
         0.0942, 0.0242],
        [0.0225, 0.0081, 0.0268, 0.0081, 0.0239, 0.0151, 0.0514, 0.0108, 0.0267,
         0.0151, 0.0262, 0.0375, 0.0151, 0.0530, 0.0335, 0.0528, 0.0469, 0.0277,
         0.0186, 0.0364, 0.0267, 0.0198, 0.0530, 0.0350, 0.0422, 0.1134, 0.0151,
         0.1158, 0.0226],
        [0.0300, 0.0121, 0.0286, 0.0121, 0.0313, 0.0248, 0.0486, 0.0182, 0.0245,
         0.0248, 0.0263, 0.0446, 0.0248, 0.0489, 0.0339, 0.0584, 0.0414, 0.0316,
         0.0255, 0.0354, 0.0245, 0.0265, 0.0489, 0.0336, 0.0382, 0.0609, 0.0248,
         0.0890, 0.0279],
        [0.0223, 0.0065, 0.0215, 0.0065, 0.0244, 0.0163, 0.0453, 0.0109, 0.0182,
         0.0163, 0.0243, 0.0394, 0.0163, 0.0506, 0.0243, 0.0479, 0.0583, 0.0338,
         0.0192, 0.0300, 0.0182, 0.0208, 0.0506, 0.0389, 0.0503, 0.1231, 0.0163,
         0.1289, 0.0206],
        [0.0133, 0.0057, 0.0153, 0.0057, 0.0183, 0.0140, 0.0507, 0.0078, 0.0205,
         0.0140, 0.0207, 0.0305, 0.0140, 0.0513, 0.0322, 0.0557, 0.0365, 0.0306,
         0.0189, 0.0311, 0.0205, 0.0182, 0.0513, 0.0391, 0.0475, 0.1570, 0.0140,
         0.1488, 0.0166],
        [0.0222, 0.0078, 0.0255, 0.0078, 0.0232, 0.0161, 0.0586, 0.0128, 0.0207,
         0.0161, 0.0223, 0.0348, 0.0161, 0.0497, 0.0316, 0.0481, 0.0400, 0.0361,
         0.0224, 0.0263, 0.0207, 0.0214, 0.0497, 0.0378, 0.0354, 0.1456, 0.0161,
         0.1148, 0.0205],
        [0.0193, 0.0059, 0.0213, 0.0059, 0.0213, 0.0130, 0.0532, 0.0081, 0.0186,
         0.0130, 0.0175, 0.0306, 0.0130, 0.0545, 0.0233, 0.0495, 0.0374, 0.0251,
         0.0231, 0.0284, 0.0186, 0.0176, 0.0545, 0.0374, 0.0430, 0.1557, 0.0130,
         0.1587, 0.0192],
        [0.0219, 0.0096, 0.0280, 0.0096, 0.0268, 0.0188, 0.0442, 0.0130, 0.0251,
         0.0188, 0.0309, 0.0324, 0.0188, 0.0597, 0.0318, 0.0532, 0.0437, 0.0266,
         0.0173, 0.0293, 0.0251, 0.0211, 0.0597, 0.0394, 0.0488, 0.1018, 0.0188,
         0.1004, 0.0248],
        [0.0254, 0.0101, 0.0235, 0.0101, 0.0354, 0.0199, 0.0481, 0.0156, 0.0211,
         0.0199, 0.0232, 0.0405, 0.0199, 0.0412, 0.0306, 0.0666, 0.0538, 0.0248,
         0.0181, 0.0363, 0.0211, 0.0225, 0.0412, 0.0440, 0.0488, 0.0904, 0.0199,
         0.0973, 0.0306],
        [0.0213, 0.0088, 0.0227, 0.0088, 0.0280, 0.0160, 0.0534, 0.0123, 0.0281,
         0.0160, 0.0242, 0.0472, 0.0160, 0.0406, 0.0385, 0.0544, 0.0416, 0.0432,
         0.0198, 0.0295, 0.0281, 0.0247, 0.0406, 0.0475, 0.0501, 0.1045, 0.0160,
         0.0977, 0.0206],
        [0.0189, 0.0079, 0.0248, 0.0079, 0.0231, 0.0165, 0.0577, 0.0105, 0.0212,
         0.0165, 0.0222, 0.0329, 0.0165, 0.0498, 0.0252, 0.0502, 0.0438, 0.0288,
         0.0185, 0.0339, 0.0212, 0.0181, 0.0498, 0.0389, 0.0488, 0.1515, 0.0165,
         0.1103, 0.0180],
        [0.0232, 0.0083, 0.0212, 0.0083, 0.0257, 0.0168, 0.0525, 0.0123, 0.0236,
         0.0168, 0.0188, 0.0372, 0.0168, 0.0548, 0.0296, 0.0532, 0.0510, 0.0316,
         0.0171, 0.0384, 0.0236, 0.0198, 0.0548, 0.0358, 0.0491, 0.1060, 0.0168,
         0.1177, 0.0191],
        [0.0223, 0.0065, 0.0215, 0.0065, 0.0244, 0.0163, 0.0453, 0.0109, 0.0182,
         0.0163, 0.0243, 0.0394, 0.0163, 0.0506, 0.0243, 0.0479, 0.0583, 0.0338,
         0.0192, 0.0300, 0.0182, 0.0208, 0.0506, 0.0389, 0.0503, 0.1231, 0.0163,
         0.1289, 0.0206],
        [0.0257, 0.0124, 0.0269, 0.0124, 0.0252, 0.0155, 0.0515, 0.0119, 0.0212,
         0.0155, 0.0245, 0.0351, 0.0155, 0.0529, 0.0335, 0.0555, 0.0477, 0.0274,
         0.0205, 0.0348, 0.0212, 0.0225, 0.0529, 0.0321, 0.0380, 0.1293, 0.0155,
         0.1004, 0.0225],
        [0.0225, 0.0070, 0.0265, 0.0070, 0.0220, 0.0177, 0.0612, 0.0123, 0.0208,
         0.0177, 0.0228, 0.0346, 0.0177, 0.0558, 0.0328, 0.0576, 0.0413, 0.0348,
         0.0200, 0.0366, 0.0208, 0.0187, 0.0558, 0.0363, 0.0458, 0.1043, 0.0177,
         0.1104, 0.0216],
        [0.0247, 0.0088, 0.0234, 0.0088, 0.0246, 0.0184, 0.0487, 0.0135, 0.0222,
         0.0184, 0.0280, 0.0349, 0.0184, 0.0457, 0.0316, 0.0590, 0.0438, 0.0308,
         0.0203, 0.0397, 0.0222, 0.0213, 0.0457, 0.0484, 0.0493, 0.1089, 0.0184,
         0.0968, 0.0254],
        [0.0300, 0.0121, 0.0286, 0.0121, 0.0313, 0.0248, 0.0486, 0.0182, 0.0245,
         0.0248, 0.0263, 0.0446, 0.0248, 0.0489, 0.0339, 0.0584, 0.0414, 0.0316,
         0.0255, 0.0354, 0.0245, 0.0265, 0.0489, 0.0336, 0.0382, 0.0609, 0.0248,
         0.0890, 0.0279],
        [0.0256, 0.0062, 0.0210, 0.0062, 0.0221, 0.0155, 0.0531, 0.0105, 0.0192,
         0.0155, 0.0223, 0.0389, 0.0155, 0.0469, 0.0386, 0.0560, 0.0382, 0.0345,
         0.0151, 0.0292, 0.0192, 0.0182, 0.0469, 0.0425, 0.0445, 0.1448, 0.0155,
         0.1130, 0.0250],
        [0.0203, 0.0072, 0.0189, 0.0072, 0.0247, 0.0152, 0.0571, 0.0136, 0.0213,
         0.0152, 0.0224, 0.0338, 0.0152, 0.0506, 0.0392, 0.0573, 0.0426, 0.0293,
         0.0210, 0.0351, 0.0213, 0.0193, 0.0506, 0.0438, 0.0501, 0.1115, 0.0152,
         0.1142, 0.0263]])